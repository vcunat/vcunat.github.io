<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Fractal Image Compressor: gui.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>gui.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;sstream&gt;</span> <span class="comment">// needed for ::load and ::rezoom</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include "gui.h"</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include "imageUtil.h"</span>  <span class="comment">// Color::getPSNR function</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include "fileUtil.h"</span>   <span class="comment">// file2string function</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="keyword">using namespace </span>std;
<a name="l00008"></a>00008 
<a name="l00010"></a>00010 <span class="keyword">static</span> QString getPSNRmessage(<span class="keyword">const</span> QImage &amp;img1,<span class="keyword">const</span> QImage &amp;img2) {
<a name="l00011"></a>00011     vector&lt;Real&gt; psnr= Color::getPSNR(img1,img2);
<a name="l00012"></a>00012     <span class="keywordflow">return</span> QObject::tr(<span class="stringliteral">"gray PSNR: %3 dB\nR,G,B: %4,%5,%6 dB"</span>) .arg(psnr[3],0,<span class="charliteral">'f'</span>,2)
<a name="l00013"></a>00013         .arg(psnr[0],0,<span class="charliteral">'f'</span>,2) .arg(psnr[1],0,<span class="charliteral">'f'</span>,2) .arg(psnr[2],0,<span class="charliteral">'f'</span>,2);
<a name="l00014"></a>00014 }
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 
<a name="l00018"></a><a class="code" href="classImageViewer.html#6db9dda908d1263afe2a7ee6ad376e5c">00018</a> <a class="code" href="classImageViewer.html#6db9dda908d1263afe2a7ee6ad376e5c" title="Initializes the object to default settings.">ImageViewer::ImageViewer</a>(QApplication &amp;app,QTranslator &amp;trans)
<a name="l00019"></a>00019 : modules_settings( <a class="code" href="structIRoot.html" title="Interface for root modules (with only one implementation MRoot), all modules are...">IRoot</a>::newCompatibleModule() ), modules_encoding(0)
<a name="l00020"></a>00020 , zoom(0), translator(trans), lastPath(QDir::current().filePath(<span class="stringliteral">"x"</span>))
<a name="l00021"></a>00021 , readAct(this), writeAct(this), compareAct(this), exitAct(this)
<a name="l00022"></a>00022 , settingsAct(this), encodeAct(this), saveAct(this)
<a name="l00023"></a>00023 , loadAct(this), clearAct(this), iterateAct(this), zoomIncAct(this), zoomDecAct(this)
<a name="l00024"></a>00024 , loadLangAct(this), useLangAct(this) {
<a name="l00025"></a>00025 <span class="comment">//  try to load guessed language translation</span>
<a name="l00026"></a>00026     <span class="keywordflow">if</span> ( <a class="code" href="classImageViewer.html#25494e9805e035847f900c675af8ca72" title="The application&amp;#39;s only translator.">translator</a>.load( <span class="stringliteral">"lang-"</span>+QLocale::system().name(), app.applicationDirPath() ) )
<a name="l00027"></a>00027         app.installTranslator(&amp;<a class="code" href="classImageViewer.html#25494e9805e035847f900c675af8ca72" title="The application&amp;#39;s only translator.">translator</a>);
<a name="l00028"></a>00028 <span class="comment">//  create a scrolling area with a label for viewing images</span>
<a name="l00029"></a>00029     <a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>= <span class="keyword">new</span> QLabel(<span class="keyword">this</span>);
<a name="l00030"></a>00030     <a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;setBackgroundRole(QPalette::Dark);
<a name="l00031"></a>00031     <a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;setSizePolicy(QSizePolicy::Ignored,QSizePolicy::Ignored);
<a name="l00032"></a>00032 
<a name="l00033"></a>00033     QScrollArea *scrollArea= <span class="keyword">new</span> QScrollArea(<span class="keyword">this</span>);
<a name="l00034"></a>00034     scrollArea-&gt;setBackgroundRole(QPalette::Dark);
<a name="l00035"></a>00035     scrollArea-&gt;setWidget(<a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>);
<a name="l00036"></a>00036     setCentralWidget(scrollArea);
<a name="l00037"></a>00037 
<a name="l00038"></a>00038     setStatusBar(<span class="keyword">new</span> QStatusBar(<span class="keyword">this</span>));
<a name="l00039"></a>00039 
<a name="l00040"></a>00040     <a class="code" href="classImageViewer.html#248bae02a6813f81f262d10bc0770af3" title="Creates all actions and connects them to correct slots.">createActions</a>();
<a name="l00041"></a>00041     <a class="code" href="classImageViewer.html#7608db3e61df6ca641d64fad093a91ca" title="Creates the menu bar and fills it with actions.">createMenus</a>();
<a name="l00042"></a>00042     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00043"></a>00043     <a class="code" href="classImageViewer.html#6272343478df5d3eaa7848a13478343f" title="Sets all texts in the application (uses current language).">translateUi</a>();
<a name="l00044"></a>00044 
<a name="l00045"></a>00045     resize(800,600);
<a name="l00046"></a>00046 }
<a name="l00047"></a>00047 
<a name="l00049"></a><a class="code" href="classImageViewer.html#248bae02a6813f81f262d10bc0770af3">00049</a> <span class="keywordtype">void</span> <a class="code" href="classImageViewer.html#248bae02a6813f81f262d10bc0770af3" title="Creates all actions and connects them to correct slots.">ImageViewer::createActions</a>() {
<a name="l00050"></a>00050 <span class="comment">//  create all actions and connect them to the appropriate slots</span>
<a name="l00051"></a>00051 <span class="preprocessor">    #define A(name) \</span>
<a name="l00052"></a>00052 <span class="preprocessor">        aConnect( &amp;name##Act, SIGNAL(triggered()), this, SLOT(name()) );</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">    #define AS(name,signal) \</span>
<a name="l00054"></a>00054 <span class="preprocessor">        aConnect( &amp;name##Act, SIGNAL(triggered()), this, SLOT(signal()) );</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">    #define AT(name) \</span>
<a name="l00056"></a>00056 <span class="preprocessor">        aConnect( &amp;name##Act, SIGNAL(toggled(bool)), this, SLOT(name(bool)) );</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>        
<a name="l00058"></a>00058     A(read)
<a name="l00059"></a>00059     A(write)
<a name="l00060"></a>00060     A(compare)
<a name="l00061"></a>00061     AS(exit,close)
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     A(settings)
<a name="l00064"></a>00064     A(encode)
<a name="l00065"></a>00065     A(save)
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     A(load)
<a name="l00068"></a>00068     A(clear)
<a name="l00069"></a>00069     A(iterate)
<a name="l00070"></a>00070     A(zoomInc)
<a name="l00071"></a>00071     A(zoomDec)
<a name="l00072"></a>00072     
<a name="l00073"></a>00073     A(loadLang)
<a name="l00074"></a>00074     AT(useLang)
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     <span class="preprocessor">#undef A</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor">    #undef AS</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">    #undef AT</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span>    
<a name="l00080"></a>00080     useLangAct.setCheckable(<span class="keyword">true</span>);
<a name="l00081"></a>00081     useLangAct.setChecked( !<a class="code" href="classImageViewer.html#25494e9805e035847f900c675af8ca72" title="The application&amp;#39;s only translator.">translator</a>.isEmpty() );
<a name="l00082"></a>00082 }
<a name="l00083"></a><a class="code" href="classImageViewer.html#7608db3e61df6ca641d64fad093a91ca">00083</a> <span class="keywordtype">void</span> <a class="code" href="classImageViewer.html#7608db3e61df6ca641d64fad093a91ca" title="Creates the menu bar and fills it with actions.">ImageViewer::createMenus</a>() {
<a name="l00084"></a>00084     imageMenu.addAction(&amp;readAct);
<a name="l00085"></a>00085     imageMenu.addAction(&amp;writeAct);
<a name="l00086"></a>00086     imageMenu.addSeparator();
<a name="l00087"></a>00087     imageMenu.addAction(&amp;compareAct);
<a name="l00088"></a>00088     imageMenu.addSeparator();
<a name="l00089"></a>00089     imageMenu.addAction(&amp;exitAct);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     compMenu.addAction(&amp;settingsAct);
<a name="l00092"></a>00092     compMenu.addAction(&amp;encodeAct);
<a name="l00093"></a>00093     compMenu.addAction(&amp;saveAct);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     decompMenu.addAction(&amp;loadAct);
<a name="l00096"></a>00096     decompMenu.addAction(&amp;clearAct);
<a name="l00097"></a>00097     decompMenu.addAction(&amp;iterateAct);
<a name="l00098"></a>00098     decompMenu.addSeparator();
<a name="l00099"></a>00099     decompMenu.addAction(&amp;zoomIncAct);
<a name="l00100"></a>00100     decompMenu.addAction(&amp;zoomDecAct);
<a name="l00101"></a>00101     
<a name="l00102"></a>00102     langMenu.addAction(&amp;loadLangAct);
<a name="l00103"></a>00103     langMenu.addAction(&amp;useLangAct);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     menuBar()-&gt;addMenu(&amp;imageMenu);
<a name="l00106"></a>00106     menuBar()-&gt;addMenu(&amp;compMenu);
<a name="l00107"></a>00107     menuBar()-&gt;addMenu(&amp;decompMenu);
<a name="l00108"></a>00108     menuBar()-&gt;addMenu(&amp;langMenu);
<a name="l00109"></a>00109     <span class="comment">//menuBar()-&gt;addMenu(&amp;helpMenu);</span>
<a name="l00110"></a>00110 }
<a name="l00111"></a><a class="code" href="classImageViewer.html#6272343478df5d3eaa7848a13478343f">00111</a> <span class="keywordtype">void</span> <a class="code" href="classImageViewer.html#6272343478df5d3eaa7848a13478343f" title="Sets all texts in the application (uses current language).">ImageViewer::translateUi</a>() {
<a name="l00112"></a>00112     setWindowTitle(tr(<span class="stringliteral">"Fractal Image Compressor"</span>));
<a name="l00113"></a>00113 <span class="comment">//  set action names and shortcuts</span>
<a name="l00114"></a>00114 <span class="preprocessor">    #define A(name,shortcut,text) \</span>
<a name="l00115"></a>00115 <span class="preprocessor">        name##Act.setText(text); \</span>
<a name="l00116"></a>00116 <span class="preprocessor">        name##Act.setShortcut(tr(shortcut));</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>    A(read,     <span class="stringliteral">"Ctrl+R"</span>,   tr(<span class="stringliteral">"Read..."</span>))
<a name="l00118"></a>00118     A(write,    <span class="stringliteral">"Ctrl+W"</span>,   tr(<span class="stringliteral">"Write..."</span>))
<a name="l00119"></a>00119     A(compare,  <span class="stringliteral">""</span>,         tr(<span class="stringliteral">"Compare to..."</span>))
<a name="l00120"></a>00120     A(exit,     <span class="stringliteral">"Ctrl+Q"</span>,   tr(<span class="stringliteral">"Quit"</span>))
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     A(settings, <span class="stringliteral">""</span>,         tr(<span class="stringliteral">"Settings"</span>))
<a name="l00123"></a>00123     A(encode,   <span class="stringliteral">" "</span>,        tr(<span class="stringliteral">"Start encoding"</span>))
<a name="l00124"></a>00124     A(save,     <span class="stringliteral">"Ctrl+S"</span>,   tr(<span class="stringliteral">"Save FCI..."</span>))
<a name="l00125"></a>00125 
<a name="l00126"></a>00126     A(load,     <span class="stringliteral">"Ctrl+L"</span>,   tr(<span class="stringliteral">"Load FCI..."</span>))
<a name="l00127"></a>00127     A(clear,    <span class="stringliteral">"Ctrl+C"</span>,   tr(<span class="stringliteral">"Clear image"</span>))
<a name="l00128"></a>00128     A(iterate,  <span class="stringliteral">"Ctrl+I"</span>,   tr(<span class="stringliteral">"Iterate image"</span>))
<a name="l00129"></a>00129     A(zoomInc,  <span class="stringliteral">"Ctrl++"</span>,   tr(<span class="stringliteral">"Increase zoom"</span>))
<a name="l00130"></a>00130     A(zoomDec,  <span class="stringliteral">"Ctrl+-"</span>,   tr(<span class="stringliteral">"Decrease zoom"</span>))
<a name="l00131"></a>00131     
<a name="l00132"></a>00132     A(loadLang, <span class="stringliteral">""</span>,         tr(<span class="stringliteral">"Load language..."</span>))
<a name="l00133"></a>00133     A(useLang,  <span class="stringliteral">""</span>,         tr(<span class="stringliteral">"Use language"</span>))
<a name="l00134"></a>00134     <span class="preprocessor">#undef A</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a>00136 <span class="comment">//  set the tiles of menu items</span>
<a name="l00137"></a>00137 <span class="preprocessor">    #define M(name,title) \</span>
<a name="l00138"></a>00138 <span class="preprocessor">        name##Menu.setTitle(title);</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span>    M(image,    tr(<span class="stringliteral">"&amp;Image"</span>));
<a name="l00140"></a>00140     M(comp,     tr(<span class="stringliteral">"&amp;Compression"</span>));
<a name="l00141"></a>00141     M(decomp,   tr(<span class="stringliteral">"&amp;Decompression"</span>));
<a name="l00142"></a>00142     M(lang,     tr(<span class="stringliteral">"&amp;Language"</span>))
<a name="l00143"></a>00143     <span class="preprocessor">#undef M</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>}
<a name="l00145"></a><a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c">00145</a> <span class="keywordtype">void</span> <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">ImageViewer::updateActions</a>() {
<a name="l00146"></a>00146     <span class="keywordtype">bool</span> pixmapOk= <a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;pixmap();
<a name="l00147"></a>00147     <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489" title="The root can be in any of these modes.">IRoot::Mode</a> mode= <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a> ? <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#7bad3d1bc9fd02e82c746004c5cb04c2" title="A status-query method.">getMode</a>() : <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489bde7c065c240ed8977122ed99ebe412f" title="no action has been done">IRoot::Clear</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="comment">//readAct.setEnabled(true);</span>
<a name="l00150"></a>00150     writeAct.setEnabled(pixmapOk);
<a name="l00151"></a>00151     compareAct.setEnabled(pixmapOk);
<a name="l00152"></a>00152     <span class="comment">//exitAct.setEnabled(true);</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154     <span class="comment">//settingsAct.setEnabled(true);</span>
<a name="l00155"></a>00155     encodeAct.setEnabled(pixmapOk);
<a name="l00156"></a>00156     saveAct.setEnabled( mode != <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489bde7c065c240ed8977122ed99ebe412f" title="no action has been done">IRoot::Clear</a> );
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <span class="comment">//loadAct.setEnabled(true);</span>
<a name="l00159"></a>00159     clearAct.setEnabled  ( mode != <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489bde7c065c240ed8977122ed99ebe412f" title="no action has been done">IRoot::Clear</a> );
<a name="l00160"></a>00160     iterateAct.setEnabled( mode != <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489bde7c065c240ed8977122ed99ebe412f" title="no action has been done">IRoot::Clear</a> );
<a name="l00161"></a>00161     zoomIncAct.setEnabled( mode != <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489bde7c065c240ed8977122ed99ebe412f" title="no action has been done">IRoot::Clear</a> &amp;&amp; <a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>&lt;3 );
<a name="l00162"></a>00162     zoomDecAct.setEnabled( mode != <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489bde7c065c240ed8977122ed99ebe412f" title="no action has been done">IRoot::Clear</a> &amp;&amp; <a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>&gt;0 );
<a name="l00163"></a>00163     
<a name="l00164"></a>00164     useLangAct.setEnabled( !<a class="code" href="classImageViewer.html#25494e9805e035847f900c675af8ca72" title="The application&amp;#39;s only translator.">translator</a>.isEmpty() );
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00168"></a>00168 <span class="keywordtype">void</span> ImageViewer::read() {
<a name="l00169"></a>00169 <span class="comment">//  get the file name</span>
<a name="l00170"></a>00170     QString fname= QFileDialog::getOpenFileName( <span class="keyword">this</span>, tr(<span class="stringliteral">"Read image file"</span>)
<a name="l00171"></a>00171     , <a class="code" href="classImageViewer.html#4d7e379993847afbab836a6e3c84c005" title="Gets the path of the last used directory (from lastPath).">lastDir</a>(), tr(<span class="stringliteral">"PNG images (*.png)\nAll files (*.*)"</span>) );
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00173"></a>00173     <span class="comment">//  no file selected</span>
<a name="l00174"></a>00174         <span class="keywordflow">return</span>;
<a name="l00175"></a>00175     lastPath.setPath(fname);
<a name="l00176"></a>00176 <span class="comment">//  try to load, check for errors</span>
<a name="l00177"></a>00177     QImage image(fname);
<a name="l00178"></a>00178     <span class="keywordflow">if</span> (image.isNull()) {
<a name="l00179"></a>00179         QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Cannot open %1."</span>).arg(fname) );
<a name="l00180"></a>00180         <span class="keywordflow">return</span>;
<a name="l00181"></a>00181     }
<a name="l00182"></a>00182 <span class="comment">//  convert to 24-bits</span>
<a name="l00183"></a>00183     <span class="keywordflow">if</span> ( image.format() != QImage::Format_RGB32 )
<a name="l00184"></a>00184         image= image.convertToFormat(QImage::Format_RGB32);
<a name="l00185"></a>00185 <span class="comment">//  display it</span>
<a name="l00186"></a>00186     <a class="code" href="classImageViewer.html#fb3073fdbeb2f8ffe611f1ca8c8f5729" title="Shows a new image.">changePixmap</a>(QPixmap::fromImage(image));
<a name="l00187"></a>00187     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 <span class="keywordtype">void</span> ImageViewer::write() {
<a name="l00190"></a>00190 <span class="comment">//  get the file name</span>
<a name="l00191"></a>00191     QString fname= QFileDialog::getSaveFileName( <span class="keyword">this</span>, tr(<span class="stringliteral">"Write image file"</span>)
<a name="l00192"></a>00192         , <a class="code" href="classImageViewer.html#4d7e379993847afbab836a6e3c84c005" title="Gets the path of the last used directory (from lastPath).">lastDir</a>(), tr(<span class="stringliteral">"PNG images (*.png)\nAll files (*.*)"</span>) );
<a name="l00193"></a>00193     <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00194"></a>00194         <span class="keywordflow">return</span>;
<a name="l00195"></a>00195     lastPath.setPath(fname);
<a name="l00196"></a>00196 <span class="comment">//  try to save the image</span>
<a name="l00197"></a>00197     <span class="keywordflow">if</span> ( !<a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;pixmap()-&gt;save(fname) ) {
<a name="l00198"></a>00198         QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Cannot write file %1."</span>).arg(fname) );
<a name="l00199"></a>00199         <span class="keywordflow">return</span>;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 <span class="keywordtype">void</span> ImageViewer::compare() {
<a name="l00204"></a>00204 <span class="comment">//  let the user choose a file</span>
<a name="l00205"></a>00205     QString fname= QFileDialog::getOpenFileName( <span class="keyword">this</span>, tr(<span class="stringliteral">"Compare to image"</span>), <a class="code" href="classImageViewer.html#4d7e379993847afbab836a6e3c84c005" title="Gets the path of the last used directory (from lastPath).">lastDir</a>()
<a name="l00206"></a>00206         , tr(<span class="stringliteral">"PNG images (*.png)\nJFIF images (*.jpg *.jpeg)\nAll files (*.*)"</span>) );
<a name="l00207"></a>00207     <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00208"></a>00208         <span class="keywordflow">return</span>;
<a name="l00209"></a>00209     lastPath.setPath(fname);
<a name="l00210"></a>00210 <span class="comment">//  open the file as an image, check it's got the same dimensions as the diplayed one</span>
<a name="l00211"></a>00211     QImage image(fname);
<a name="l00212"></a>00212     <span class="keywordflow">if</span> ( image.format() != QImage::Format_RGB32 )
<a name="l00213"></a>00213         image= image.convertToFormat(QImage::Format_RGB32);
<a name="l00214"></a>00214     <span class="keywordflow">if</span> (image.isNull()) {
<a name="l00215"></a>00215         QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Cannot open %1."</span>).arg(fname) );
<a name="l00216"></a>00216         <span class="keywordflow">return</span>;
<a name="l00217"></a>00217     }
<a name="l00218"></a>00218     <span class="keywordflow">if</span> ( image.rect() != <a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;pixmap()-&gt;rect() ) {
<a name="l00219"></a>00219         QMessageBox::information
<a name="l00220"></a>00220             ( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Images don't have the same dimensions."</span>).arg(fname) );
<a name="l00221"></a>00221         <span class="keywordflow">return</span>;
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223 <span class="comment">//  compute the PSNRs and display them</span>
<a name="l00224"></a>00224     QString message= getPSNRmessage( image, <a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;pixmap()-&gt;toImage() );
<a name="l00225"></a>00225     QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Comparison"</span>), message );
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 <span class="keywordtype">void</span> ImageViewer::settings() {
<a name="l00228"></a>00228     <a class="code" href="structIRoot.html" title="Interface for root modules (with only one implementation MRoot), all modules are...">IRoot</a> *newSettings= <a class="code" href="classImageViewer.html#90c08bf442a6b51fdb696f6dd04a1120" title="Module tree holding current settings.">modules_settings</a>-&gt;<a class="code" href="classInterface.html#fa78e8716ee75f703eee492ce833d768" title="Works like abstractClone(), but is public and returns the correct type.">clone</a>();
<a name="l00229"></a>00229     <a class="code" href="classSettingsDialog.html" title="Represents the encoding-settings dialog.">SettingsDialog</a> dialog(<span class="keyword">this</span>,newSettings);
<a name="l00230"></a>00230     <span class="keywordtype">bool</span> accepted= dialog.exec();
<a name="l00231"></a>00231     newSettings= dialog.getSettings();
<a name="l00232"></a>00232     <span class="keywordflow">if</span> (accepted) <span class="comment">// the dialog wasn't cancelled -&gt; swap with the current and new settings</span>
<a name="l00233"></a>00233         swap(newSettings,<a class="code" href="classImageViewer.html#90c08bf442a6b51fdb696f6dd04a1120" title="Module tree holding current settings.">modules_settings</a>);
<a name="l00234"></a>00234     <span class="keyword">delete</span> newSettings;
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 <span class="keywordtype">void</span> ImageViewer::encode() {
<a name="l00237"></a>00237     <a class="code" href="classEncodingProgress.html#3ff4014982265faf3c0460cf8e42a82d" title="Creates the dialog and starts encoding.">EncodingProgress::create</a>(<span class="keyword">this</span>);
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 <span class="keywordtype">void</span> ImageViewer::encDone() {
<a name="l00240"></a>00240     <span class="keywordtype">int</span> encMsecs;
<a name="l00241"></a>00241     <a class="code" href="structIRoot.html" title="Interface for root modules (with only one implementation MRoot), all modules are...">IRoot</a> *modules_encoded= <a class="code" href="classEncodingProgress.html#6ffbb159a60f85afdd5a915cadfa5f2a" title="Collects results and destroys the dialog.">EncodingProgress::destroy</a>(encMsecs);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (modules_encoded) { <span class="comment">// encoding successful - iterate the image and display some info</span>
<a name="l00244"></a>00244         <a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>= 0;
<a name="l00245"></a>00245     <span class="comment">//  replace the old state</span>
<a name="l00246"></a>00246         <span class="keyword">delete</span> <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>;
<a name="l00247"></a>00247         <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>= modules_encoded;
<a name="l00248"></a>00248     <span class="comment">//  decode the image</span>
<a name="l00249"></a>00249         QImage beforeImg= <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#dac999d1ea22a6fb36ac20a2d0860a52" title="Saves current decoding state into a QImage.">toImage</a>();
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         QTime decTime;
<a name="l00252"></a>00252         decTime.start();
<a name="l00253"></a>00253         <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(MTypes::Clear);
<a name="l00254"></a>00254         <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(MTypes::Iterate,AutoIterationCount);
<a name="l00255"></a>00255         <span class="keywordtype">int</span> decMsecs= decTime.elapsed();
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         QImage afterImg= <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#dac999d1ea22a6fb36ac20a2d0860a52" title="Saves current decoding state into a QImage.">toImage</a>();
<a name="l00258"></a>00258         <a class="code" href="classImageViewer.html#fb3073fdbeb2f8ffe611f1ca8c8f5729" title="Shows a new image.">changePixmap</a>( QPixmap::fromImage(afterImg) );
<a name="l00259"></a>00259     <span class="comment">//  show some info</span>
<a name="l00260"></a>00260         QString message= tr(<span class="stringliteral">"Time to encode: %1 seconds\nTime to decode: %2 seconds\n"</span>)
<a name="l00261"></a>00261             .arg(encMsecs/1000.0) .arg(decMsecs/1000.0) + getPSNRmessage(beforeImg,afterImg);
<a name="l00262"></a>00262         QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"encoded"</span>), message );
<a name="l00263"></a>00263         <a class="code" href="classImageViewer.html#99d5b729e54361ab1a16e5632e84b796" title="String containing (if nonempty) the last encoded/decoded data.">encData</a>.clear();
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 <span class="keywordtype">void</span> ImageViewer::save() {
<a name="l00269"></a>00269 <span class="comment">//  get a filename to suggest</span>
<a name="l00270"></a>00270     QFileInfo finfo(lastPath.path());
<a name="l00271"></a>00271     QString fname= finfo.dir().filePath( finfo.completeBaseName() + tr(<span class="stringliteral">".fci"</span>) );
<a name="l00272"></a>00272     fname= QFileDialog::getSaveFileName
<a name="l00273"></a>00273         ( <span class="keyword">this</span>, tr(<span class="stringliteral">"Save encoded image"</span>), fname, tr(<span class="stringliteral">"Fractal-compressed images (*.fci)"</span>) );
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00275"></a>00275         <span class="keywordflow">return</span>;
<a name="l00276"></a>00276     lastPath.setPath(fname);
<a name="l00277"></a>00277     <span class="keywordflow">if</span> ( !<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#c63c7d9a50467b652dbc12064afb0158" title="Shorthand: saves an encoded image to a file - returns the number of bytes written...">toFile</a>( fname.toStdString().c_str() ) )
<a name="l00278"></a>00278         QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Cannot write file %1."</span>).arg(fname) );
<a name="l00279"></a>00279 }
<a name="l00280"></a>00280 <span class="keywordtype">void</span> ImageViewer::load() {
<a name="l00281"></a>00281     QString fname= QFileDialog::getOpenFileName
<a name="l00282"></a>00282         ( <span class="keyword">this</span>, tr(<span class="stringliteral">"Load encoded image"</span>), <a class="code" href="classImageViewer.html#4d7e379993847afbab836a6e3c84c005" title="Gets the path of the last used directory (from lastPath).">lastDir</a>(), tr(<span class="stringliteral">"Fractal-compressed images (*.fci)"</span>) );
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00284"></a>00284         <span class="keywordflow">return</span>;
<a name="l00285"></a>00285     lastPath.setPath(fname);
<a name="l00286"></a>00286 <span class="comment">//  IRoot needs to be loaded from cleared state</span>
<a name="l00287"></a>00287     <a class="code" href="structIRoot.html" title="Interface for root modules (with only one implementation MRoot), all modules are...">IRoot</a> *modules_old= <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>;
<a name="l00288"></a>00288     <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>= <a class="code" href="classImageViewer.html#90c08bf442a6b51fdb696f6dd04a1120" title="Module tree holding current settings.">modules_settings</a>-&gt;<a class="code" href="classInterface.html#fa78e8716ee75f703eee492ce833d768" title="Works like abstractClone(), but is public and returns the correct type.">clone</a>(Module::ShallowCopy);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290     <span class="keywordtype">string</span> decData;
<a name="l00291"></a>00291     <span class="keywordtype">bool</span> error= !file2string( fname.toStdString().c_str(), decData );
<a name="l00292"></a>00292     <span class="keywordflow">if</span> (!error) {
<a name="l00293"></a>00293         stringstream stream(decData);
<a name="l00294"></a>00294         error= !<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#9c39aa4485564a5c75071c9ddc7d01a6" title="Loads image from a file - returns true on success (to be run on in Clear state),...">fromStream</a>( stream, <a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a> );
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (error) {
<a name="l00298"></a>00298         QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Cannot load file %1."</span>).arg(fname) );
<a name="l00299"></a>00299         swap(<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>,modules_old);
<a name="l00300"></a>00300     } <span class="keywordflow">else</span> { <span class="comment">// loading was successful</span>
<a name="l00301"></a>00301         swap(<a class="code" href="classImageViewer.html#99d5b729e54361ab1a16e5632e84b796" title="String containing (if nonempty) the last encoded/decoded data.">encData</a>,decData);
<a name="l00302"></a>00302         <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(Clear);
<a name="l00303"></a>00303         <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(MTypes::Iterate,AutoIterationCount);
<a name="l00304"></a>00304         <a class="code" href="classImageViewer.html#fb3073fdbeb2f8ffe611f1ca8c8f5729" title="Shows a new image.">changePixmap</a>( QPixmap::fromImage(<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#dac999d1ea22a6fb36ac20a2d0860a52" title="Saves current decoding state into a QImage.">toImage</a>()) );
<a name="l00305"></a>00305         <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     <span class="keyword">delete</span> modules_old;
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 <span class="keywordtype">void</span> ImageViewer::clear() {
<a name="l00311"></a>00311     <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(Clear);
<a name="l00312"></a>00312     <a class="code" href="classImageViewer.html#fb3073fdbeb2f8ffe611f1ca8c8f5729" title="Shows a new image.">changePixmap</a>( QPixmap::fromImage(<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#dac999d1ea22a6fb36ac20a2d0860a52" title="Saves current decoding state into a QImage.">toImage</a>()) );
<a name="l00313"></a>00313     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 <span class="keywordtype">void</span> ImageViewer::iterate() {
<a name="l00316"></a>00316     <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(Iterate);
<a name="l00317"></a>00317     <a class="code" href="classImageViewer.html#fb3073fdbeb2f8ffe611f1ca8c8f5729" title="Shows a new image.">changePixmap</a>( QPixmap::fromImage(<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#dac999d1ea22a6fb36ac20a2d0860a52" title="Saves current decoding state into a QImage.">toImage</a>()) );
<a name="l00318"></a>00318     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 <span class="keywordtype">void</span> ImageViewer::zoomInc() {
<a name="l00321"></a>00321     ++<a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>;
<a name="l00322"></a>00322     <span class="keywordflow">if</span> (!<a class="code" href="classImageViewer.html#83366adbd818dbbd461286a25d03321d" title="Reloads the image, iterates and shows it (returns true on success).">rezoom</a>())
<a name="l00323"></a>00323         --<a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>, QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Zooming failed."</span>) );
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 <span class="keywordtype">void</span> ImageViewer::zoomDec() {
<a name="l00326"></a>00326     --<a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>;
<a name="l00327"></a>00327     ASSERT(<a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>&gt;=0);
<a name="l00328"></a>00328     <span class="keywordflow">if</span> (!<a class="code" href="classImageViewer.html#83366adbd818dbbd461286a25d03321d" title="Reloads the image, iterates and shows it (returns true on success).">rezoom</a>())
<a name="l00329"></a>00329         ++<a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>, QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Zooming failed."</span>) );
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 <span class="keywordtype">void</span> ImageViewer::loadLang() {
<a name="l00332"></a>00332     QString fname= QFileDialog::getOpenFileName( <span class="keyword">this</span>, tr(<span class="stringliteral">"Load Language"</span>)
<a name="l00333"></a>00333         , QApplication::applicationDirPath(), tr(<span class="stringliteral">"Translation Definitions (*.qm)"</span>) );
<a name="l00334"></a>00334     <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00335"></a>00335         <span class="keywordflow">return</span>;
<a name="l00336"></a>00336     <span class="keywordflow">if</span> (<a class="code" href="classImageViewer.html#25494e9805e035847f900c675af8ca72" title="The application&amp;#39;s only translator.">translator</a>.load(fname)) {
<a name="l00337"></a>00337         useLangAct.setChecked(<span class="keyword">true</span>);
<a name="l00338"></a>00338         useLang(<span class="keyword">true</span>);
<a name="l00339"></a>00339     } <span class="keywordflow">else</span>
<a name="l00340"></a>00340         QMessageBox::warning( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>), tr(<span class="stringliteral">"Cannot load %1."</span>).arg(fname) );
<a name="l00341"></a>00341     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 <span class="keywordtype">void</span> ImageViewer::useLang(<span class="keywordtype">bool</span> use) {
<a name="l00344"></a>00344     <span class="keywordflow">if</span> (use)
<a name="l00345"></a>00345         QApplication::installTranslator(&amp;<a class="code" href="classImageViewer.html#25494e9805e035847f900c675af8ca72" title="The application&amp;#39;s only translator.">translator</a>);
<a name="l00346"></a>00346     <span class="keywordflow">else</span>
<a name="l00347"></a>00347         QApplication::removeTranslator(&amp;<a class="code" href="classImageViewer.html#25494e9805e035847f900c675af8ca72" title="The application&amp;#39;s only translator.">translator</a>);
<a name="l00348"></a>00348     <a class="code" href="classImageViewer.html#6272343478df5d3eaa7848a13478343f" title="Sets all texts in the application (uses current language).">translateUi</a>();
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a><a class="code" href="classImageViewer.html#83366adbd818dbbd461286a25d03321d">00351</a> <span class="keywordtype">bool</span> <a class="code" href="classImageViewer.html#83366adbd818dbbd461286a25d03321d" title="Reloads the image, iterates and shows it (returns true on success).">ImageViewer::rezoom</a>() {
<a name="l00352"></a>00352 <span class="comment">//  create a stream that contains the "saved image"</span>
<a name="l00353"></a>00353     stringstream stream;
<a name="l00354"></a>00354     <span class="keywordflow">if</span> ( <a class="code" href="classImageViewer.html#99d5b729e54361ab1a16e5632e84b796" title="String containing (if nonempty) the last encoded/decoded data.">encData</a>.empty() ) {    <span class="comment">// cache is empty - we have to create it (save the image)</span>
<a name="l00355"></a>00355         <span class="keywordflow">if</span> ( !<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#dd0fca54a9f1508750054c6115d4024d" title="Saves an encoded image into a stream, returns true on success.">toStream</a>(stream) )
<a name="l00356"></a>00356             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00357"></a>00357         <a class="code" href="classImageViewer.html#99d5b729e54361ab1a16e5632e84b796" title="String containing (if nonempty) the last encoded/decoded data.">encData</a>= stream.str();
<a name="l00358"></a>00358     } <span class="keywordflow">else</span>                      <span class="comment">// reusing the cache</span>
<a name="l00359"></a>00359         stream.str(<a class="code" href="classImageViewer.html#99d5b729e54361ab1a16e5632e84b796" title="String containing (if nonempty) the last encoded/decoded data.">encData</a>);
<a name="l00360"></a>00360 <span class="comment">//  reload the image from the stream</span>
<a name="l00361"></a>00361     <a class="code" href="structIRoot.html" title="Interface for root modules (with only one implementation MRoot), all modules are...">IRoot</a> *newRoot= <a class="code" href="classImageViewer.html#90c08bf442a6b51fdb696f6dd04a1120" title="Module tree holding current settings.">modules_settings</a>-&gt;<a class="code" href="classInterface.html#fa78e8716ee75f703eee492ce833d768" title="Works like abstractClone(), but is public and returns the correct type.">clone</a>(Module::ShallowCopy);
<a name="l00362"></a>00362     <span class="keywordflow">if</span> ( newRoot-&gt;<a class="code" href="structIRoot.html#9c39aa4485564a5c75071c9ddc7d01a6" title="Loads image from a file - returns true on success (to be run on in Clear state),...">fromStream</a>(stream,<a class="code" href="classImageViewer.html#beadd072cca7c1d20f6c98563644ea62" title="The current zoom, see IRoot::fromStream.">zoom</a>) ) {
<a name="l00363"></a>00363         <span class="keyword">delete</span> <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>;
<a name="l00364"></a>00364         <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>= newRoot;
<a name="l00365"></a>00365     } <span class="keywordflow">else</span> {
<a name="l00366"></a>00366         <span class="keyword">delete</span> newRoot;
<a name="l00367"></a>00367         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00368"></a>00368     }
<a name="l00369"></a>00369 <span class="comment">//  successfully reloaded -&gt; auto-iterate the image and show it</span>
<a name="l00370"></a>00370     <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(MTypes::Clear);
<a name="l00371"></a>00371     <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#06514db009eb7589bdb4111dff9f8179" title="Performs a decoding action (e.g. clearing, multiple iteration).">decodeAct</a>(MTypes::Iterate,AutoIterationCount);
<a name="l00372"></a>00372     <a class="code" href="classImageViewer.html#fb3073fdbeb2f8ffe611f1ca8c8f5729" title="Shows a new image.">changePixmap</a>( QPixmap::fromImage(<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#dac999d1ea22a6fb36ac20a2d0860a52" title="Saves current decoding state into a QImage.">toImage</a>()) );
<a name="l00373"></a>00373     <a class="code" href="classImageViewer.html#4f6f972b69d15e03908a1d9e191f8e1c" title="Updates the availability of all actions.">updateActions</a>();
<a name="l00374"></a>00374     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 
<a name="l00379"></a>00379 
<a name="l00380"></a><a class="code" href="classSettingsDialog.html#b2ed34a9075e48a290c7e8111da0e836">00380</a> <a class="code" href="classSettingsDialog.html#b2ed34a9075e48a290c7e8111da0e836" title="Initializes all the widgets in the dialog.">SettingsDialog::SettingsDialog</a>( <a class="code" href="classImageViewer.html" title="Represents the main window of the program, providing a GUI.">ImageViewer</a> *parent, <a class="code" href="structIRoot.html" title="Interface for root modules (with only one implementation MRoot), all modules are...">IRoot</a> *settingsHolder )
<a name="l00381"></a>00381 : QDialog(parent,Qt::Dialog), settings(settingsHolder) {
<a name="l00382"></a>00382     setWindowTitle(tr(<span class="stringliteral">"Compression settings"</span>));
<a name="l00383"></a>00383     setModal(<span class="keyword">true</span>);
<a name="l00384"></a>00384 <span class="comment">//  create a grid layout for the dialog</span>
<a name="l00385"></a>00385     QGridLayout *layout= <span class="keyword">new</span> QGridLayout;
<a name="l00386"></a>00386     setLayout(layout);
<a name="l00387"></a>00387 <span class="comment">//  add a tree widget</span>
<a name="l00388"></a>00388     this-&gt;<a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>= <span class="keyword">new</span> QTreeWidget(<span class="keyword">this</span>);
<a name="l00389"></a>00389     <a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>-&gt;setHeaderLabel(tr(<span class="stringliteral">"Modules"</span>));
<a name="l00390"></a>00390     layout-&gt;addWidget(<a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>,0,0);
<a name="l00391"></a>00391 <span class="comment">//  add a group-box to display settings of a module</span>
<a name="l00392"></a>00392     this-&gt;<a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a>= <span class="keyword">new</span> QGroupBox(<span class="keyword">this</span>);
<a name="l00393"></a>00393     layout-&gt;addWidget(<a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a>,0,1);
<a name="l00394"></a>00394 <span class="comment">//  add a load/save button-box and connect it to a slot of this dialog</span>
<a name="l00395"></a>00395     this-&gt;<a class="code" href="classSettingsDialog.html#d6fecb0050f74d164c6bcc037265d322" title="the button-box for loading and saving">loadSaveButtons</a>= <span class="keyword">new</span> QDialogButtonBox
<a name="l00396"></a>00396     ( QDialogButtonBox::Open|QDialogButtonBox::Save, Qt::Horizontal, <span class="keyword">this</span> );
<a name="l00397"></a>00397     aConnect( <a class="code" href="classSettingsDialog.html#d6fecb0050f74d164c6bcc037265d322" title="the button-box for loading and saving">loadSaveButtons</a>, SIGNAL(clicked(QAbstractButton*))
<a name="l00398"></a>00398     , <span class="keyword">this</span>, SLOT(<a class="code" href="classSettingsDialog.html#ae84370afbad110420abe32a6906c17e" title="Handles loading and saving of the settings.">loadSaveClick</a>(QAbstractButton*)) );
<a name="l00399"></a>00399     layout-&gt;addWidget(<a class="code" href="classSettingsDialog.html#d6fecb0050f74d164c6bcc037265d322" title="the button-box for loading and saving">loadSaveButtons</a>,1,0,Qt::AlignLeft);
<a name="l00400"></a>00400 <span class="comment">//  add a button-box and connect the clicking actions</span>
<a name="l00401"></a>00401     QDialogButtonBox *buttons= <span class="keyword">new</span> QDialogButtonBox
<a name="l00402"></a>00402     ( QDialogButtonBox::Ok|QDialogButtonBox::Cancel, Qt::Horizontal, <span class="keyword">this</span> );
<a name="l00403"></a>00403     layout-&gt;addWidget(buttons,1,1); <span class="comment">// the right-bottom cell</span>
<a name="l00404"></a>00404     aConnect( buttons, SIGNAL(accepted()), <span class="keyword">this</span>, SLOT(accept()) );
<a name="l00405"></a>00405     aConnect( buttons, SIGNAL(rejected()), <span class="keyword">this</span>, SLOT(reject()) );
<a name="l00406"></a>00406 <span class="comment">//  create the tree</span>
<a name="l00407"></a>00407     QTreeWidgetItem *treeRoot= <span class="keyword">new</span> QTreeWidgetItem;
<a name="l00408"></a>00408     <a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>-&gt;addTopLevelItem(treeRoot);
<a name="l00409"></a>00409     treeRoot-&gt;setText( 0, tr(<span class="stringliteral">"Root"</span>) );
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     aConnect( <a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>, SIGNAL(<a class="code" href="classSettingsDialog.html#f6952fde42b7fb67ef105589a3913695" title="Changes the contents of the settings group-box when selecting in the settings tree...">currentItemChanged</a>(QTreeWidgetItem*,QTreeWidgetItem*))
<a name="l00412"></a>00412     , <span class="keyword">this</span>, SLOT(<a class="code" href="classSettingsDialog.html#f6952fde42b7fb67ef105589a3913695" title="Changes the contents of the settings group-box when selecting in the settings tree...">currentItemChanged</a>(QTreeWidgetItem*,QTreeWidgetItem*)) );
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <a class="code" href="classSettingsDialog.html#471c111d0503f4f674e99a37f2f1d526" title="Initializes the settings tree and group-box contents from settings.">initialize</a>();
<a name="l00415"></a>00415 }
<a name="l00416"></a><a class="code" href="classSettingsDialog.html#471c111d0503f4f674e99a37f2f1d526">00416</a> <span class="keywordtype">void</span> <a class="code" href="classSettingsDialog.html#471c111d0503f4f674e99a37f2f1d526" title="Initializes the settings tree and group-box contents from settings.">SettingsDialog::initialize</a>() {
<a name="l00417"></a>00417     QTreeWidgetItem *treeRoot= <a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>-&gt;topLevelItem(0);
<a name="l00418"></a>00418     ASSERT( treeRoot &amp;&amp; <a class="code" href="classSettingsDialog.html#4a69c8102888157f73966fabf5738af7" title="the settings we edit">settings</a> &amp;&amp; <a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a> );
<a name="l00419"></a>00419     
<a name="l00420"></a>00420     <a class="code" href="util_8h.html#bb3cacfaf213957aecd3ce28bd08a93f" title="Clears a QList of pointers (and deletes the pointers).">clearQtContainer</a>( treeRoot-&gt;takeChildren() );
<a name="l00421"></a>00421     
<a name="l00422"></a>00422     <a class="code" href="classSettingsDialog.html#4a69c8102888157f73966fabf5738af7" title="the settings we edit">settings</a>-&gt;<a class="code" href="classModule.html#70e9c083660b1f2b6f8276e99ca4d923" title="Creates or updates settings-box and/or settings-tree. if overridden in derived modules...">adjustSettings</a>(-1,treeRoot,<a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a>);
<a name="l00423"></a>00423     <a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>-&gt;setCurrentItem(treeRoot);
<a name="l00424"></a>00424     <a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>-&gt;expandAll();
<a name="l00425"></a>00425 }
<a name="l00426"></a><a class="code" href="classSettingsDialog.html#f6952fde42b7fb67ef105589a3913695">00426</a> <span class="keywordtype">void</span> <a class="code" href="classSettingsDialog.html#f6952fde42b7fb67ef105589a3913695" title="Changes the contents of the settings group-box when selecting in the settings tree...">SettingsDialog::currentItemChanged</a>(QTreeWidgetItem *curItem,QTreeWidgetItem*) {
<a name="l00427"></a>00427 <span class="comment">//  get the module that should show its settings</span>
<a name="l00428"></a>00428     ASSERT(curItem);
<a name="l00429"></a>00429     <a class="code" href="classModule.html" title="A common base class for all modules.">Module</a> *curMod= <span class="keyword">static_cast&lt;</span><a class="code" href="classModule.html" title="A common base class for all modules.">Module</a>*<span class="keyword">&gt;</span>( curItem-&gt;data(0,Qt::UserRole).value&lt;<span class="keywordtype">void</span>*&gt;() );
<a name="l00430"></a>00430     ASSERT(curMod);
<a name="l00431"></a>00431 <span class="comment">//  clear the settings box and make the module fill it</span>
<a name="l00432"></a>00432     <a class="code" href="util_8h.html#bb3cacfaf213957aecd3ce28bd08a93f" title="Clears a QList of pointers (and deletes the pointers).">clearQtContainer</a>( <a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a>-&gt;children() );
<a name="l00433"></a>00433     <a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a>-&gt;setTitle( tr(<span class="stringliteral">"%1 module settings"</span>) .arg(QObject::tr(curMod-&gt;<a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().name)) );
<a name="l00434"></a>00434     curMod-&gt;<a class="code" href="classModule.html#70e9c083660b1f2b6f8276e99ca4d923" title="Creates or updates settings-box and/or settings-tree. if overridden in derived modules...">adjustSettings</a>(-1,0,<a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a>);
<a name="l00435"></a>00435 }
<a name="l00436"></a><a class="code" href="classSettingsDialog.html#c06c04c2fefe974cdf074f769256fcc4">00436</a> <span class="keywordtype">void</span> <a class="code" href="classSettingsDialog.html#c06c04c2fefe974cdf074f769256fcc4" title="Adjusts the settings when changed in the settings group-box.">SettingsDialog::settingChanges</a>(<span class="keywordtype">int</span> which) {
<a name="l00437"></a>00437     QTreeWidgetItem *tree= <a class="code" href="classSettingsDialog.html#1244b2d2c467283ecfafac8b22f0c030" title="the settings tree">treeWidget</a>-&gt;currentItem();
<a name="l00438"></a>00438     <a class="code" href="classModule.html" title="A common base class for all modules.">Module</a> *module= <span class="keyword">static_cast&lt;</span><a class="code" href="classModule.html" title="A common base class for all modules.">Module</a>*<span class="keyword">&gt;</span>( tree-&gt;data(0,Qt::UserRole).value&lt;<span class="keywordtype">void</span>*&gt;() );
<a name="l00439"></a>00439     module-&gt;<a class="code" href="classModule.html#70e9c083660b1f2b6f8276e99ca4d923" title="Creates or updates settings-box and/or settings-tree. if overridden in derived modules...">adjustSettings</a>(which,tree,<a class="code" href="classSettingsDialog.html#9288cb236a6ca85e49ace7e36c26c75a" title="the settings group-box">setBox</a>);
<a name="l00440"></a>00440 }
<a name="l00441"></a><a class="code" href="classSettingsDialog.html#ae84370afbad110420abe32a6906c17e">00441</a> <span class="keywordtype">void</span> <a class="code" href="classSettingsDialog.html#ae84370afbad110420abe32a6906c17e" title="Handles loading and saving of the settings.">SettingsDialog::loadSaveClick</a>(QAbstractButton *button) {
<a name="l00442"></a>00442     QDialogButtonBox::StandardButton test= <a class="code" href="classSettingsDialog.html#d6fecb0050f74d164c6bcc037265d322" title="the button-box for loading and saving">loadSaveButtons</a>-&gt;standardButton(button);
<a name="l00443"></a>00443     <span class="keywordflow">switch</span> ( test ) {
<a name="l00444"></a>00444     <span class="keywordflow">case</span> QDialogButtonBox::Open: { <span class="comment">// open-button has been clicked</span>
<a name="l00445"></a>00445     <span class="comment">//  ask for the name to load from</span>
<a name="l00446"></a>00446         QString fname= QFileDialog::getOpenFileName( <span class="keyword">this</span>, tr(<span class="stringliteral">"Load settings file"</span>)
<a name="l00447"></a>00447             , <a class="code" href="classSettingsDialog.html#85668b3b06cdf21073e9cbf3d01c3890" title="Returns a reference to the parent instance of ImageViewer.">parentViewer</a>().lastDir(), tr(<span class="stringliteral">"Fractal compression settings (*.fcs)"</span>) );
<a name="l00448"></a>00448         <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00449"></a>00449             <span class="keywordflow">return</span>;
<a name="l00450"></a>00450     <span class="comment">//  try to load the settings</span>
<a name="l00451"></a>00451         <a class="code" href="structIRoot.html" title="Interface for root modules (with only one implementation MRoot), all modules are...">IRoot</a> *newSettings= <a class="code" href="classSettingsDialog.html#4a69c8102888157f73966fabf5738af7" title="the settings we edit">settings</a>-&gt;<a class="code" href="classInterface.html#fa78e8716ee75f703eee492ce833d768" title="Works like abstractClone(), but is public and returns the correct type.">clone</a>(Module::ShallowCopy);
<a name="l00452"></a>00452         <span class="keywordflow">if</span> ( newSettings-&gt;<a class="code" href="structIRoot.html#6733ebffc59c3b08eb4e12c0d63d03fb" title="Loads all settings from a file (to be run on a shallow module), returns true on success...">allSettingsFromFile</a>(fname.toStdString().c_str()) ) {
<a name="l00453"></a>00453             <span class="keyword">delete</span> <a class="code" href="classSettingsDialog.html#4a69c8102888157f73966fabf5738af7" title="the settings we edit">settings</a>;
<a name="l00454"></a>00454             <a class="code" href="classSettingsDialog.html#4a69c8102888157f73966fabf5738af7" title="the settings we edit">settings</a>= newSettings;
<a name="l00455"></a>00455             <a class="code" href="classSettingsDialog.html#471c111d0503f4f674e99a37f2f1d526" title="Initializes the settings tree and group-box contents from settings.">initialize</a>();
<a name="l00456"></a>00456         } <span class="keywordflow">else</span> {
<a name="l00457"></a>00457             QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>)
<a name="l00458"></a>00458                 , tr(<span class="stringliteral">"Cannot load settings from %1."</span>).arg(fname) );
<a name="l00459"></a>00459             <span class="keyword">delete</span> newSettings;
<a name="l00460"></a>00460         }
<a name="l00461"></a>00461     }   <span class="keywordflow">break</span>;
<a name="l00462"></a>00462     <span class="keywordflow">case</span> QDialogButtonBox::Save: { <span class="comment">// save-button has been clicked</span>
<a name="l00463"></a>00463     <span class="comment">//  ask for the name to save in</span>
<a name="l00464"></a>00464         QString fname= QFileDialog::getSaveFileName( <span class="keyword">this</span>, tr(<span class="stringliteral">"Save settings file"</span>)
<a name="l00465"></a>00465             , <a class="code" href="classSettingsDialog.html#85668b3b06cdf21073e9cbf3d01c3890" title="Returns a reference to the parent instance of ImageViewer.">parentViewer</a>().lastDir()+<span class="stringliteral">"/settings.fcs"</span>
<a name="l00466"></a>00466             , tr(<span class="stringliteral">"Fractal compression settings (*.fcs)"</span>) );
<a name="l00467"></a>00467         <span class="keywordflow">if</span> (fname.isEmpty())
<a name="l00468"></a>00468             <span class="keywordflow">return</span>;
<a name="l00469"></a>00469     <span class="comment">//  try to save the settings</span>
<a name="l00470"></a>00470         <span class="keywordflow">if</span> ( !<a class="code" href="classSettingsDialog.html#4a69c8102888157f73966fabf5738af7" title="the settings we edit">settings</a>-&gt;<a class="code" href="structIRoot.html#342b859d5e0a77101da207b2131c6ad1" title="Saves all settings to a file (incl. child modules), returns true on success.">allSettingsToFile</a>(fname.toStdString().c_str()) )
<a name="l00471"></a>00471             QMessageBox::information( <span class="keyword">this</span>, tr(<span class="stringliteral">"Error"</span>)
<a name="l00472"></a>00472                 , tr(<span class="stringliteral">"Cannot save settings into %1."</span>).arg(fname) );
<a name="l00473"></a>00473     }   <span class="keywordflow">break</span>;
<a name="l00474"></a>00474     <span class="keywordflow">default</span>:
<a name="l00475"></a>00475         ASSERT(<span class="keyword">false</span>);
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00480"></a>00480 <span class="keyword">namespace </span>NOSPACE {
<a name="l00481"></a>00481     QWidget* newSettingsWidget(<a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2" title="Types of a setting.">Module::ChoiceType</a> type,QWidget *parent) {
<a name="l00482"></a>00482         QWidget *result=0;
<a name="l00483"></a>00483         <span class="keywordflow">switch</span> (type) {
<a name="l00484"></a>00484         <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2386c8944cfbec7a3e93f98cc6fd98df2" title="integer from an interval">Module::Int</a>:
<a name="l00485"></a>00485         <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc208f683b276a92487fd695f445261fbc1" title="integer from an interval prefixed with 2^">Module::IntLog2</a>:
<a name="l00486"></a>00486             result= <span class="keyword">new</span> QSpinBox(parent);
<a name="l00487"></a>00487             <span class="keywordflow">break</span>;
<a name="l00488"></a>00488         <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc23dc9b84a0008e6302a3ec70e40a2d9f7" title="real number from an interval">Module::Float</a>:
<a name="l00489"></a>00489             result= <span class="keyword">new</span> QDoubleSpinBox(parent);
<a name="l00490"></a>00490             <span class="keywordflow">break</span>;
<a name="l00491"></a>00491         <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc244a205073fbed44dccd69bb4adf53e5c" title="a connection to another module (shown as a combo-box)">Module::ModuleCombo</a>:
<a name="l00492"></a>00492         <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2af3df288d47faf7294135ae83d214922" title="choice from a list of strings">Module::Combo</a>:
<a name="l00493"></a>00493             result= <span class="keyword">new</span> QComboBox(parent);
<a name="l00494"></a>00494             <span class="keywordflow">break</span>;
<a name="l00495"></a>00495         <span class="keywordflow">default</span>:
<a name="l00496"></a>00496             ASSERT(<span class="keyword">false</span>);
<a name="l00497"></a>00497         }<span class="comment">// switch</span>
<a name="l00498"></a>00498         <span class="keywordflow">return</span> result;
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500 }
<a name="l00501"></a><a class="code" href="classModule.html#70e9c083660b1f2b6f8276e99ca4d923">00501</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#70e9c083660b1f2b6f8276e99ca4d923" title="Creates or updates settings-box and/or settings-tree. if overridden in derived modules...">Module::adjustSettings</a>(<span class="keywordtype">int</span> which,QTreeWidgetItem *myTree,QGroupBox *setBox) {
<a name="l00502"></a>00502     <span class="keywordflow">if</span> (which&lt;0) { <span class="comment">// no change has really happened</span>
<a name="l00503"></a>00503         ASSERT(which==-1);
<a name="l00504"></a>00504         <span class="keywordflow">if</span> (myTree) {
<a name="l00505"></a>00505         <span class="comment">//  I should create the subtree -&gt; store this-pointer as data</span>
<a name="l00506"></a>00506             ASSERT( myTree-&gt;childCount() == 0 );
<a name="l00507"></a>00507             myTree-&gt;setData( 0, Qt::UserRole, QVariant::fromValue((<span class="keywordtype">void</span>*)<span class="keyword">this</span>) );
<a name="l00508"></a>00508             <span class="keywordflow">if</span> (!<a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>) {
<a name="l00509"></a>00509                 myTree-&gt;setFlags(0);
<a name="l00510"></a>00510                 <span class="keywordflow">return</span>;
<a name="l00511"></a>00511             }
<a name="l00512"></a>00512         <span class="comment">//  find child modules and make them create their subtrees</span>
<a name="l00513"></a>00513             <span class="keyword">const</span> <a class="code" href="structModule_1_1SettingTypeItem.html" title="Represents the type of one setting - including label, description, etc.">SettingTypeItem</a> *setType= <a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().<a class="code" href="structModule_1_1TypeInfo.html#0f441c8f8d4dceec75aee383f478e625" title="The types of module&amp;#39;s settings.">setType</a>;
<a name="l00514"></a>00514             <span class="keyword">const</span> <a class="code" href="structModule_1_1SettingItem.html" title="Represents one setting value in a module.">SettingItem</a> *setItem= <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>;
<a name="l00515"></a>00515             <span class="keywordflow">for</span> (; setType-&gt;<a class="code" href="structModule_1_1SettingTypeItem.html#e3cd318999bb228272c0e65adf6b20c7" title="The type of this setting.">type</a>.<a class="code" href="structModule_1_1SettingType.html#8baa28833330e216ae1fd6feebd812dd" title="The type of the item.">type</a>!=<a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc26cbe19ba5e3780bc9739e6c0092b4431" title="a list-terminator">Stop</a>; ++setItem,++setType)
<a name="l00516"></a>00516                 <span class="keywordflow">if</span> ( setType-&gt;<a class="code" href="structModule_1_1SettingTypeItem.html#e3cd318999bb228272c0e65adf6b20c7" title="The type of this setting.">type</a>.<a class="code" href="structModule_1_1SettingType.html#8baa28833330e216ae1fd6feebd812dd" title="The type of the item.">type</a> == <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc244a205073fbed44dccd69bb4adf53e5c" title="a connection to another module (shown as a combo-box)">ModuleCombo</a> ) {
<a name="l00517"></a>00517                 <span class="comment">//  it is a module -&gt; label its subtree-root and recurse (polymorphically)</span>
<a name="l00518"></a>00518                     ASSERT(setItem-&gt;<a class="code" href="structModule_1_1SettingItem.html#17f621f90a4080f17bc1db4e60f26670" title="Pointer to the connected module (if type is Module::ModuleCombo).">m</a>);
<a name="l00519"></a>00519                     <span class="keywordflow">if</span> ( !setItem-&gt;<a class="code" href="structModule_1_1SettingItem.html#17f621f90a4080f17bc1db4e60f26670" title="Pointer to the connected module (if type is Module::ModuleCombo).">m</a>-&gt;<a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().<a class="code" href="structModule_1_1TypeInfo.html#6fabafddb7b1669d9cbb6b3996a8c4a9" title="The number of setting items.">setLength</a> )
<a name="l00520"></a>00520                         <span class="keywordflow">continue</span>; <span class="comment">// skipping modules with no settings</span>
<a name="l00521"></a>00521                     QTreeWidgetItem *childTree= <span class="keyword">new</span> QTreeWidgetItem(myTree);
<a name="l00522"></a>00522                     childTree-&gt;setText( 0, QObject::tr(setType-&gt;<a class="code" href="structModule_1_1SettingTypeItem.html#34d8d0935d6da312a7de0a4601c993a1" title="The text label of the setting.">label</a>) );
<a name="l00523"></a>00523                     setItem-&gt;<a class="code" href="structModule_1_1SettingItem.html#17f621f90a4080f17bc1db4e60f26670" title="Pointer to the connected module (if type is Module::ModuleCombo).">m</a>-&gt;<a class="code" href="classModule.html#70e9c083660b1f2b6f8276e99ca4d923" title="Creates or updates settings-box and/or settings-tree. if overridden in derived modules...">adjustSettings</a>( -1, childTree, 0 );
<a name="l00524"></a>00524                 }
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526         <span class="keywordtype">int</span> setLength= <a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().<a class="code" href="structModule_1_1TypeInfo.html#6fabafddb7b1669d9cbb6b3996a8c4a9" title="The number of setting items.">setLength</a>;
<a name="l00527"></a>00527         <span class="keywordflow">if</span> ( setBox &amp;&amp; setLength ) {
<a name="l00528"></a>00528         <span class="comment">//  clear the group box</span>
<a name="l00529"></a>00529             <a class="code" href="util_8h.html#bb3cacfaf213957aecd3ce28bd08a93f" title="Clears a QList of pointers (and deletes the pointers).">clearQtContainer</a>( setBox-&gt;children() );
<a name="l00530"></a>00530             ASSERT( setBox-&gt;children().empty() );
<a name="l00531"></a>00531         <span class="comment">//  fill the group-box</span>
<a name="l00532"></a>00532             QGridLayout *layout= <span class="keyword">new</span> QGridLayout(setBox);
<a name="l00533"></a>00533             setBox-&gt;setLayout(layout);
<a name="l00534"></a>00534             <span class="keyword">const</span> <a class="code" href="structModule_1_1SettingTypeItem.html" title="Represents the type of one setting - including label, description, etc.">SettingTypeItem</a> *typeItem= <a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().<a class="code" href="structModule_1_1TypeInfo.html#0f441c8f8d4dceec75aee383f478e625" title="The types of module&amp;#39;s settings.">setType</a>;
<a name="l00535"></a>00535             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;setLength; ++i,++typeItem) { <span class="comment">// add a line - one option</span>
<a name="l00536"></a>00536                 QString desc= QObject::tr(typeItem-&gt;<a class="code" href="structModule_1_1SettingTypeItem.html#197d650263045a20cd4ebd36357d702a" title="Description text.">desc</a>);
<a name="l00537"></a>00537                 QLabel *label= <span class="keyword">new</span> QLabel( QObject::tr(typeItem-&gt;<a class="code" href="structModule_1_1SettingTypeItem.html#34d8d0935d6da312a7de0a4601c993a1" title="The text label of the setting.">label</a>), setBox );
<a name="l00538"></a>00538                 label-&gt;setToolTip(desc);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540                 QWidget *widget= newSettingsWidget( typeItem-&gt;<a class="code" href="structModule_1_1SettingTypeItem.html#e3cd318999bb228272c0e65adf6b20c7" title="The type of this setting.">type</a>.<a class="code" href="structModule_1_1SettingType.html#8baa28833330e216ae1fd6feebd812dd" title="The type of the item.">type</a>, setBox );
<a name="l00541"></a>00541                 <a class="code" href="classModule.html#babe0a33447b9464cb651b5453450c29" title="Initializes a widget according to a setting-item type.">settingsType2widget</a>( widget, *typeItem );
<a name="l00542"></a>00542                 <a class="code" href="classModule.html#5ca282210fd6e65bc3b41f0779a5add3" title="Writes a setting value into a widget.">settings2widget</a>( widget, i );
<a name="l00543"></a>00543                 widget-&gt;setToolTip(desc);
<a name="l00544"></a>00544                 label-&gt;setBuddy(widget);
<a name="l00545"></a>00545                 layout-&gt;addWidget( label, i, 0 );
<a name="l00546"></a>00546                 layout-&gt;addWidget( widget, i, 1 );
<a name="l00547"></a>00547 
<a name="l00548"></a>00548                 <a class="code" href="classSignalChanger.html" title="Converts signals from various types of widgets.">SignalChanger</a> *changer= <span class="keyword">new</span> <a class="code" href="classSignalChanger.html" title="Converts signals from various types of widgets.">SignalChanger</a>(i,widget,typeItem-&gt;<a class="code" href="structModule_1_1SettingTypeItem.html#e3cd318999bb228272c0e65adf6b20c7" title="The type of this setting.">type</a>.<a class="code" href="structModule_1_1SettingType.html#8baa28833330e216ae1fd6feebd812dd" title="The type of the item.">type</a>);
<a name="l00549"></a>00549                 aConnect( changer, SIGNAL(notify(<span class="keywordtype">int</span>))          <span class="comment">// assuming the setBox's</span>
<a name="l00550"></a>00550                 , setBox-&gt;parent(), SLOT(settingChanges(<span class="keywordtype">int</span>)) ); <span class="comment">// parent is SettingsDialog</span>
<a name="l00551"></a>00551             } <span class="comment">// for loop</span>
<a name="l00552"></a>00552         } <span class="comment">// filling the box</span>
<a name="l00553"></a>00553     } <span class="keywordflow">else</span> {
<a name="l00554"></a>00554     <span class="comment">//  which&gt;=0... a setting has changed -&gt; get the change from the widget</span>
<a name="l00555"></a>00555         ASSERT( which &lt; <a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().setLength );
<a name="l00556"></a>00556         QLayoutItem *item= setBox-&gt;layout()-&gt;itemAt(2*which+1);
<a name="l00557"></a>00557         ASSERT(item);
<a name="l00558"></a>00558         <a class="code" href="classModule.html#0bfe9d67632bb3e6a1c6efed1e9f8f43" title="Reads a setting value from a widget.">widget2settings</a>( item-&gt;widget() , which );
<a name="l00559"></a>00559     <span class="comment">//  handle module-type settings</span>
<a name="l00560"></a>00560         <span class="keyword">const</span> <a class="code" href="structModule_1_1SettingTypeItem.html" title="Represents the type of one setting - including label, description, etc.">SettingTypeItem</a> &amp;setType= <a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().<a class="code" href="structModule_1_1TypeInfo.html#0f441c8f8d4dceec75aee383f478e625" title="The types of module&amp;#39;s settings.">setType</a>[which];
<a name="l00561"></a>00561         <span class="keywordflow">if</span> ( setType.type.type == <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc244a205073fbed44dccd69bb4adf53e5c" title="a connection to another module (shown as a combo-box)">ModuleCombo</a> ) {
<a name="l00562"></a>00562             ASSERT(myTree);
<a name="l00563"></a>00563         <span class="comment">//  get the new module id and check whether it has really changed</span>
<a name="l00564"></a>00564             <a class="code" href="structModule_1_1SettingItem.html" title="Represents one setting value in a module.">SettingItem</a> &amp;setItem= <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>[which];
<a name="l00565"></a>00565             <span class="keywordtype">int</span> newId= (*setType.type.data.compatIDs)[setItem.<a class="code" href="structModule_1_1SettingItem.html#71a46105fdddba87d6fcc3f18648a608" title="The setting value.">val</a>.<a class="code" href="unionModule_1_1SettingValue.html#de47847b53cb9c43af708e37526fb648" title="Setting value for integer/module types (see Module::ChoiceType).">i</a>];
<a name="l00566"></a>00566             if ( newId == setItem.<a class="code" href="structModule_1_1SettingItem.html#17f621f90a4080f17bc1db4e60f26670" title="Pointer to the connected module (if type is Module::ModuleCombo).">m</a>-&gt;<a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().<a class="code" href="structModule_1_1TypeInfo.html#256e567189a46d449dd975a82936134b" title="The module-type&amp;#39;s ID.">id</a> )
<a name="l00567"></a>00567                 <span class="keywordflow">return</span>;
<a name="l00568"></a>00568         <span class="comment">//  replace the child module</span>
<a name="l00569"></a>00569             <a class="code" href="util_8h.html#bb3cacfaf213957aecd3ce28bd08a93f" title="Clears a QList of pointers (and deletes the pointers).">clearQtContainer</a>( myTree-&gt;takeChildren() );
<a name="l00570"></a>00570             <span class="keyword">delete</span> setItem.<a class="code" href="structModule_1_1SettingItem.html#17f621f90a4080f17bc1db4e60f26670" title="Pointer to the connected module (if type is Module::ModuleCombo).">m</a>;
<a name="l00571"></a>00571             setItem.<a class="code" href="structModule_1_1SettingItem.html#17f621f90a4080f17bc1db4e60f26670" title="Pointer to the connected module (if type is Module::ModuleCombo).">m</a>= <a class="code" href="classModuleFactory.html#a04f013d81baf61218167b7baccc732d" title="Returns a new instance of the module-type with given id.">ModuleFactory::newModule</a>(newId);
<a name="l00572"></a>00572             <a class="code" href="classModule.html#70e9c083660b1f2b6f8276e99ca4d923" title="Creates or updates settings-box and/or settings-tree. if overridden in derived modules...">adjustSettings</a>( -1, myTree, 0 );
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574     <span class="comment">//  update module defaults</span>
<a name="l00575"></a>00575         <a class="code" href="classModuleFactory.html#de033bafb95d3e0603a0df2ac1d4590f" title="Sets appropriate prototype settings according to given module&amp;#39;s settings.">ModuleFactory::changeDefaultSettings</a>(*<span class="keyword">this</span>);
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 }
<a name="l00578"></a><a class="code" href="classModule.html#0bfe9d67632bb3e6a1c6efed1e9f8f43">00578</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#0bfe9d67632bb3e6a1c6efed1e9f8f43" title="Reads a setting value from a widget.">Module::widget2settings</a>(<span class="keyword">const</span> QWidget *widget,<span class="keywordtype">int</span> which) {
<a name="l00579"></a>00579     ASSERT( 0&lt;=which &amp;&amp; which&lt;<a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().setLength );
<a name="l00580"></a>00580     <span class="keywordflow">switch</span>( <a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().setType[which].type.type ) {
<a name="l00581"></a>00581     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2386c8944cfbec7a3e93f98cc6fd98df2" title="integer from an interval">Int</a>:
<a name="l00582"></a>00582     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc208f683b276a92487fd695f445261fbc1" title="integer from an interval prefixed with 2^">IntLog2</a>:
<a name="l00583"></a>00583         <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>[which].<a class="code" href="structModule_1_1SettingItem.html#71a46105fdddba87d6fcc3f18648a608" title="The setting value.">val</a>.<a class="code" href="unionModule_1_1SettingValue.html#de47847b53cb9c43af708e37526fb648" title="Setting value for integer/module types (see Module::ChoiceType).">i</a>= debugCast&lt;const QSpinBox*&gt;(widget)-&gt;value();
<a name="l00584"></a>00584         <span class="keywordflow">break</span>;
<a name="l00585"></a>00585     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc23dc9b84a0008e6302a3ec70e40a2d9f7" title="real number from an interval">Float</a>:
<a name="l00586"></a>00586         <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>[which].<a class="code" href="structModule_1_1SettingItem.html#71a46105fdddba87d6fcc3f18648a608" title="The setting value.">val</a>.<a class="code" href="unionModule_1_1SettingValue.html#61257c78151335f2985193130565aebe" title="Setting value for real-number type (see Module::ChoiceType).">f</a>= debugCast&lt;const QDoubleSpinBox*&gt;(widget)-&gt;value();
<a name="l00587"></a>00587         <span class="keywordflow">break</span>;
<a name="l00588"></a>00588     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc244a205073fbed44dccd69bb4adf53e5c" title="a connection to another module (shown as a combo-box)">ModuleCombo</a>:
<a name="l00589"></a>00589     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2af3df288d47faf7294135ae83d214922" title="choice from a list of strings">Combo</a>:
<a name="l00590"></a>00590         <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>[which].<a class="code" href="structModule_1_1SettingItem.html#71a46105fdddba87d6fcc3f18648a608" title="The setting value.">val</a>.<a class="code" href="unionModule_1_1SettingValue.html#de47847b53cb9c43af708e37526fb648" title="Setting value for integer/module types (see Module::ChoiceType).">i</a>= debugCast&lt;const QComboBox*&gt;(widget)-&gt;currentIndex();
<a name="l00591"></a>00591         <span class="keywordflow">break</span>;
<a name="l00592"></a>00592     <span class="keywordflow">default</span>:
<a name="l00593"></a>00593         ASSERT(<span class="keyword">false</span>);
<a name="l00594"></a>00594     }<span class="comment">// switch</span>
<a name="l00595"></a>00595 }
<a name="l00596"></a><a class="code" href="classModule.html#5ca282210fd6e65bc3b41f0779a5add3">00596</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#5ca282210fd6e65bc3b41f0779a5add3" title="Writes a setting value into a widget.">Module::settings2widget</a>(QWidget *widget,<span class="keywordtype">int</span> which) {
<a name="l00597"></a>00597     ASSERT( 0&lt;=which &amp;&amp; which&lt;<a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().setLength );
<a name="l00598"></a>00598     <span class="keywordflow">switch</span>( <a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>().setType[which].type.type ) {
<a name="l00599"></a>00599     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2386c8944cfbec7a3e93f98cc6fd98df2" title="integer from an interval">Int</a>:
<a name="l00600"></a>00600     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc208f683b276a92487fd695f445261fbc1" title="integer from an interval prefixed with 2^">IntLog2</a>:
<a name="l00601"></a>00601         debugCast&lt;QSpinBox*&gt;(widget)-&gt;setValue( <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>[which].val.i );
<a name="l00602"></a>00602         <span class="keywordflow">break</span>;
<a name="l00603"></a>00603     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc23dc9b84a0008e6302a3ec70e40a2d9f7" title="real number from an interval">Float</a>:
<a name="l00604"></a>00604         debugCast&lt;QDoubleSpinBox*&gt;(widget)-&gt;setValue( <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>[which].val.f );
<a name="l00605"></a>00605         <span class="keywordflow">break</span>;
<a name="l00606"></a>00606     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc244a205073fbed44dccd69bb4adf53e5c" title="a connection to another module (shown as a combo-box)">ModuleCombo</a>:
<a name="l00607"></a>00607     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2af3df288d47faf7294135ae83d214922" title="choice from a list of strings">Combo</a>:
<a name="l00608"></a>00608         debugCast&lt;QComboBox*&gt;(widget)-&gt;setCurrentIndex( <a class="code" href="classModule.html#05a8665b709707811945fa29714c2e00" title="The current setting values of this Module.">settings</a>[which].val.i );
<a name="l00609"></a>00609         <span class="keywordflow">break</span>;
<a name="l00610"></a>00610     <span class="keywordflow">default</span>:
<a name="l00611"></a>00611         ASSERT(<span class="keyword">false</span>);
<a name="l00612"></a>00612     }<span class="comment">// switch</span>
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 <span class="keyword">namespace </span>NOSPACE {
<a name="l00615"></a>00615     <span class="keyword">class </span>ItemAdder {
<a name="l00616"></a>00616         QComboBox *box;
<a name="l00617"></a>00617     <span class="keyword">public</span>:
<a name="l00618"></a>00618         ItemAdder(QWidget *widget): box( debugCast&lt;QComboBox*&gt;(widget) ) {}
<a name="l00619"></a>00619         <span class="keywordtype">void</span> operator()(<span class="keywordtype">int</span> i) {
<a name="l00620"></a>00620             <span class="keyword">const</span> <a class="code" href="structModule_1_1TypeInfo.html" title="Information about one module-type.">Module::TypeInfo</a> &amp;info= <a class="code" href="classModuleFactory.html#4fe6e48e4ad958b0c10c57fdfeec4d0a" title="Returns a reference to the module prototype with given id.">ModuleFactory::prototype</a>(i).<a class="code" href="classModule.html#987b1cfc57aae292f5375fbb88a4fd32" title="Returns reference to module-type&amp;#39;s information, like count and types of settings...">info</a>();
<a name="l00621"></a>00621             box-&gt;addItem(QObject::tr(info.<a class="code" href="structModule_1_1TypeInfo.html#c17eb9809aa38ac30ef1ff582d10e20e" title="The module-type&amp;#39;s name.">name</a>));
<a name="l00622"></a>00622             box-&gt;setItemData( box-&gt;count()-1, QObject::tr(info.<a class="code" href="structModule_1_1TypeInfo.html#74881f0d3b05303f64b87237fdb549ed" title="The module-type&amp;#39;s description.">desc</a>), Qt::ToolTipRole );
<a name="l00623"></a>00623         }
<a name="l00624"></a>00624     };
<a name="l00625"></a>00625 }
<a name="l00626"></a><a class="code" href="classModule.html#babe0a33447b9464cb651b5453450c29">00626</a> <span class="keywordtype">void</span> <a class="code" href="classModule.html#babe0a33447b9464cb651b5453450c29" title="Initializes a widget according to a setting-item type.">Module::settingsType2widget</a>(QWidget *widget,<span class="keyword">const</span> <a class="code" href="structModule_1_1SettingTypeItem.html" title="Represents the type of one setting - including label, description, etc.">SettingTypeItem</a> &amp;typeItem) {
<a name="l00627"></a>00627     ASSERT(widget);
<a name="l00628"></a>00628     <span class="keyword">const</span> <a class="code" href="structModule_1_1SettingType.html" title="Represents the type of one module&amp;#39;s setting - without label and description.">SettingType</a> &amp;type= typeItem.<a class="code" href="structModule_1_1SettingTypeItem.html#e3cd318999bb228272c0e65adf6b20c7" title="The type of this setting.">type</a>;
<a name="l00629"></a>00629     
<a name="l00630"></a>00630     <span class="keywordflow">switch</span>(type.<a class="code" href="structModule_1_1SettingType.html#8baa28833330e216ae1fd6feebd812dd" title="The type of the item.">type</a>) {
<a name="l00631"></a>00631     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc208f683b276a92487fd695f445261fbc1" title="integer from an interval prefixed with 2^">IntLog2</a>:
<a name="l00632"></a>00632         debugCast&lt;QSpinBox*&gt;(widget)-&gt;setPrefix(QObject::tr(<span class="stringliteral">"2^"</span>));
<a name="l00633"></a>00633     <span class="comment">//  fall through</span>
<a name="l00634"></a>00634     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2386c8944cfbec7a3e93f98cc6fd98df2" title="integer from an interval">Int</a>: {
<a name="l00635"></a>00635         debugCast&lt;QSpinBox*&gt;(widget)-&gt;setRange( type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#0cf546113d6577ec7840a02425fb9663" title="Lower and upper bound (type==Int,IntLog2).">i</a>[0], type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#0cf546113d6577ec7840a02425fb9663" title="Lower and upper bound (type==Int,IntLog2).">i</a>[1] );
<a name="l00636"></a>00636     <span class="comment">//  try to guess a reasonable step for the spin-box</span>
<a name="l00637"></a>00637         <span class="keywordtype">int</span> range= type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#0cf546113d6577ec7840a02425fb9663" title="Lower and upper bound (type==Int,IntLog2).">i</a>[1]-type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#0cf546113d6577ec7840a02425fb9663" title="Lower and upper bound (type==Int,IntLog2).">i</a>[0];
<a name="l00638"></a>00638         <span class="keywordtype">int</span> step= (int)<a class="code" href="util_8h.html#c49fb60fb446fb0706a94c830099fb70" title="This function is missing in earlier GCC versions, here implemented via exp2 and log2...">exp10</a>(floor(log10(range/5)));
<a name="l00639"></a>00639         <span class="keywordflow">if</span> (!(step&gt;0))
<a name="l00640"></a>00640             step= 1;
<a name="l00641"></a>00641         debugCast&lt;QSpinBox*&gt;(widget)-&gt;setSingleStep(step);
<a name="l00642"></a>00642         <span class="keywordflow">break</span>;
<a name="l00643"></a>00643         }
<a name="l00644"></a>00644     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc23dc9b84a0008e6302a3ec70e40a2d9f7" title="real number from an interval">Float</a>: {
<a name="l00645"></a>00645         debugCast&lt;QDoubleSpinBox*&gt;(widget)-&gt;setRange( type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#e6adabdcd52292db35e3c12798af97f7" title="Lower and upper bound (type==Float).">f</a>[0], type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#e6adabdcd52292db35e3c12798af97f7" title="Lower and upper bound (type==Float).">f</a>[1] );
<a name="l00646"></a>00646     <span class="comment">//  try to guess a reasonable step for the spin-box</span>
<a name="l00647"></a>00647         <span class="keywordtype">float</span> range= type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#e6adabdcd52292db35e3c12798af97f7" title="Lower and upper bound (type==Float).">f</a>[1]-type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#e6adabdcd52292db35e3c12798af97f7" title="Lower and upper bound (type==Float).">f</a>[0];
<a name="l00648"></a>00648         debugCast&lt;QDoubleSpinBox*&gt;(widget)-&gt;setSingleStep( <a class="code" href="util_8h.html#c49fb60fb446fb0706a94c830099fb70" title="This function is missing in earlier GCC versions, here implemented via exp2 and log2...">exp10</a>(floor(log10(range/5))) );
<a name="l00649"></a>00649         <span class="keywordflow">break</span>;
<a name="l00650"></a>00650         }
<a name="l00651"></a>00651     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc244a205073fbed44dccd69bb4adf53e5c" title="a connection to another module (shown as a combo-box)">ModuleCombo</a>: {
<a name="l00652"></a>00652         <span class="keyword">const</span> vector&lt;int&gt; &amp;modules= *typeItem.<a class="code" href="structModule_1_1SettingTypeItem.html#e3cd318999bb228272c0e65adf6b20c7" title="The type of this setting.">type</a>.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#11c3bbb60a8dac48aaf38266da89a93c" title="Pointer to the vector of IDs of compatible modules (type==ModuleCombo), meant to...">compatIDs</a>;
<a name="l00653"></a>00653         for_each( modules, ItemAdder(widget) );
<a name="l00654"></a>00654         <span class="keywordflow">break</span>;
<a name="l00655"></a>00655         }
<a name="l00656"></a>00656     <span class="keywordflow">case</span> <a class="code" href="classModule.html#0baedffa9e50881da4626ec45dc23cc2af3df288d47faf7294135ae83d214922" title="choice from a list of strings">Combo</a>:
<a name="l00657"></a>00657         debugCast&lt;QComboBox*&gt;(widget)-&gt;addItems( QObject::tr(type.<a class="code" href="structModule_1_1SettingType.html#70a4906ea1b9f01bd9bd5cd999313679" title="Additional data, differs for different type.">data</a>.<a class="code" href="structModule_1_1SettingType.html#7099a0c8755ce6f7ad16df83d6a391b2" title="Lines of the combo-box (type==Combo).">text</a>).split(<span class="charliteral">'\n'</span>) );
<a name="l00658"></a>00658         <span class="keywordflow">break</span>;
<a name="l00659"></a>00659     <span class="keywordflow">default</span>:
<a name="l00660"></a>00660         ASSERT(<span class="keyword">false</span>);
<a name="l00661"></a>00661     }<span class="comment">// switch</span>
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="preprocessor">#ifndef NDEBUG</span>
<a name="l00666"></a>00666 <span class="preprocessor"></span><span class="keywordtype">void</span> ImageViewer::mousePressEvent(QMouseEvent *event) {
<a name="l00667"></a>00667 <span class="comment">//  check the event, get the clicking point coordinates relative to the image</span>
<a name="l00668"></a>00668     <span class="keywordflow">if</span> ( !event || !<a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>
<a name="l00669"></a>00669     || <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;<a class="code" href="structIRoot.html#7bad3d1bc9fd02e82c746004c5cb04c2" title="A status-query method.">getMode</a>() == <a class="code" href="structIRoot.html#b0f523cc6c5db940bd9965a3c8071489bde7c065c240ed8977122ed99ebe412f" title="no action has been done">IRoot::Clear</a>)
<a name="l00670"></a>00670         <span class="keywordflow">return</span>;
<a name="l00671"></a>00671     <span class="keyword">const</span> QPoint click= <a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;mapFrom( <span class="keyword">this</span>, event-&gt;pos() );
<a name="l00672"></a>00672 <span class="comment">//  get the image</span>
<a name="l00673"></a>00673     QPixmap pixmap= *<a class="code" href="classImageViewer.html#56adb42a54fe4ff4e67ccb3e6229fb6d" title="A pointer to the label showing images.">imageLabel</a>-&gt;pixmap();
<a name="l00674"></a>00674     <span class="keywordflow">if</span> ( click.isNull() )
<a name="l00675"></a>00675         <span class="keywordflow">return</span>;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     <span class="keyword">static</span> QWidget *debugWidget= 0;
<a name="l00678"></a>00678     <span class="keyword">delete</span> debugWidget;
<a name="l00679"></a>00679     debugWidget= <a class="code" href="classImageViewer.html#c26faa64ab8fe05ac7c34539e114ebf2" title="Module tree that&amp;#39;s currently encoding or the last one.">modules_encoding</a>-&gt;debugModule(pixmap,click);
<a name="l00680"></a>00680     debugWidget-&gt;setParent(<span class="keyword">this</span>);
<a name="l00681"></a>00681     debugWidget-&gt;setWindowFlags(Qt::Dialog);
<a name="l00682"></a>00682     debugWidget-&gt;show();
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <a class="code" href="classImageViewer.html#fb3073fdbeb2f8ffe611f1ca8c8f5729" title="Shows a new image.">changePixmap</a>(pixmap);
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 <span class="preprocessor">#endif</span>
<a name="l00687"></a>00687 <span class="preprocessor"></span>
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <a class="code" href="classEncodingProgress.html" title="A dialog showing encoding progress.">EncodingProgress</a> *<a class="code" href="classEncodingProgress.html#64235b460e73b03c8e88abe48113ab66" title="Pointer to the single instance of the class.">EncodingProgress::instance</a>= 0;
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Aug 6 22:33:14 2009 for Fractal Image Compressor by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
