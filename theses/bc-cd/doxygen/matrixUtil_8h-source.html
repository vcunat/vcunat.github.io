<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Fractal Image Compressor: matrixUtil.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>matrixUtil.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef MATRIXUTIL_HEADER_</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define MATRIXUTIL_HEADER_</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00005"></a><a class="code" href="structBlock.html">00005</a> <span class="keyword">struct </span><a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> {
<a name="l00006"></a>00006     <span class="keywordtype">short</span> x0, y0, xend, yend;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008     <span class="keywordtype">int</span> width()<span class="keyword">  const  </span>{ <span class="keywordflow">return</span> xend-x0; }
<a name="l00009"></a>00009     <span class="keywordtype">int</span> height()<span class="keyword"> const  </span>{ <span class="keywordflow">return</span> yend-y0; }
<a name="l00010"></a>00010     <span class="keywordtype">int</span> size()<span class="keyword">   const  </span>{ <span class="keywordflow">return</span> width()*height(); }
<a name="l00011"></a>00011 
<a name="l00012"></a>00012     <span class="keywordtype">bool</span> contains(<span class="keywordtype">short</span> x,<span class="keywordtype">short</span> y)<span class="keyword"> const</span>
<a name="l00013"></a>00013 <span class="keyword">        </span>{ <span class="keywordflow">return</span> x0&lt;=x &amp;&amp; x&lt;xend &amp;&amp; y0&lt;=y &amp;&amp; y&lt;yend; }
<a name="l00014"></a>00014 
<a name="l00015"></a>00015     <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a>() {}
<a name="l00016"></a>00016     <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a>(<span class="keywordtype">short</span> x0_,<span class="keywordtype">short</span> y0_,<span class="keywordtype">short</span> xend_,<span class="keywordtype">short</span> yend_)
<a name="l00017"></a>00017     : x0(x0_), y0(y0_), xend(xend_), yend(yend_) {}
<a name="l00018"></a>00018 };
<a name="l00019"></a>00019 
<a name="l00021"></a>00021 
<a name="l00024"></a><a class="code" href="structMatrixSlice.html">00024</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I=PtrInt&gt; <span class="keyword">struct </span><a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice</a> {
<a name="l00025"></a><a class="code" href="structMatrixSlice.html#9e4cfe84c8ab9cbda78ac3751455432c">00025</a>     <span class="keyword">typedef</span> <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice&lt;const T,I&gt;</a> <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">Const</a>; 
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe">00027</a>     T *<a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>;   
<a name="l00028"></a><a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a">00028</a>     I <a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>;  
<a name="l00029"></a>00029 
<a name="l00031"></a><a class="code" href="structMatrixSlice.html#938de95377a1b31cca3c1a95a7fc0bae">00031</a>     <a class="code" href="structMatrixSlice.html#938de95377a1b31cca3c1a95a7fc0bae" title="Initializes an empty slice.">MatrixSlice</a>(): <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>(0) {}
<a name="l00032"></a>00032 
<a name="l00034"></a><a class="code" href="structMatrixSlice.html#ffa2c04d87edb25db7e0c57a40313670">00034</a>     <span class="keyword">static</span> <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice</a> <a class="code" href="structMatrixSlice.html#ffa2c04d87edb25db7e0c57a40313670" title="Creates an instance with pre-filled member fields.">makeRaw</a>(T *<a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>,I <a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>) {
<a name="l00035"></a>00035         <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice</a> result;
<a name="l00036"></a>00036         result.<a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>= start;
<a name="l00037"></a>00037         result.<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>= colSkip;
<a name="l00038"></a>00038         <span class="keywordflow">return</span> result;
<a name="l00039"></a>00039     }
<a name="l00040"></a>00040 
<a name="l00042"></a><a class="code" href="structMatrixSlice.html#89a99ff9abb6bb67c23c81f04ad189ea">00042</a>     <a class="code" href="structMatrixSlice.html#89a99ff9abb6bb67c23c81f04ad189ea" title="Converts to a matrix of constant objects (shallow copy).">operator Const</a>()<span class="keyword"> const </span>{
<a name="l00043"></a>00043         <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">Const</a> result;
<a name="l00044"></a>00044         result.<a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>= <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>;
<a name="l00045"></a>00045         result.<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>= <a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>;
<a name="l00046"></a>00046         <span class="keywordflow">return</span> result;
<a name="l00047"></a>00047     }
<a name="l00048"></a>00048 
<a name="l00050"></a><a class="code" href="structMatrixSlice.html#d6619c3d16ca39070074ea8adee8e8e9">00050</a>     T* <a class="code" href="structMatrixSlice.html#d6619c3d16ca39070074ea8adee8e8e9" title="Indexing operator - returns pointer to a column.">operator[]</a>(I column) {
<a name="l00051"></a>00051         ASSERT( <a class="code" href="structMatrixSlice.html#d92c2e882b4aed3f8faf17d2fb8350f3" title="Returns whether the matrix is allocated (and thus usable for indexing).">isValid</a>() );
<a name="l00052"></a>00052         <span class="keywordflow">return</span> <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>+column*<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>;
<a name="l00053"></a>00053     }
<a name="l00055"></a><a class="code" href="structMatrixSlice.html#2e35cae1334e600d75d6bb0efdb2a589">00055</a>     <span class="keyword">const</span> T* <a class="code" href="structMatrixSlice.html#2e35cae1334e600d75d6bb0efdb2a589" title="Const version of indexing operator - doesn&amp;#39;t allow to change the elements.">operator[]</a>(I column)<span class="keyword"> const </span>{
<a name="l00056"></a>00056         <span class="keywordflow">return</span> <a class="code" href="util_8h.html#7dcbfa1a47034c99f2e76ea4ffa8700a" title="Automatic version of const_cast for pointers.">constCast</a>(*<span class="keyword">this</span>)[column];
<a name="l00057"></a>00057     }
<a name="l00058"></a>00058 
<a name="l00061"></a><a class="code" href="structMatrixSlice.html#77c5e74ff4eede8a934ca2a34e5e927d">00061</a>     <span class="keywordtype">void</span> <a class="code" href="structMatrixSlice.html#77c5e74ff4eede8a934ca2a34e5e927d" title="Reallocates the matrix for a new size.">allocate</a>( I width, I height, T *memory=0 ) {
<a name="l00062"></a>00062         ASSERT( width&gt;0 &amp;&amp; height&gt;0 );
<a name="l00063"></a>00063         <a class="code" href="structMatrixSlice.html#65bfd74a4e24a056486b67e5e38ed365" title="Releases the memory.">free</a>();
<a name="l00064"></a>00064         <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>= memory ? memory : <span class="keyword">new</span> T[width*height];
<a name="l00065"></a>00065         <a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>= height;
<a name="l00066"></a>00066     }
<a name="l00068"></a><a class="code" href="structMatrixSlice.html#65bfd74a4e24a056486b67e5e38ed365">00068</a>     <span class="keywordtype">void</span> <a class="code" href="structMatrixSlice.html#65bfd74a4e24a056486b67e5e38ed365" title="Releases the memory.">free</a>() {
<a name="l00069"></a>00069         <span class="keyword">delete</span>[] <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>;
<a name="l00070"></a>00070         <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>= 0;
<a name="l00071"></a>00071     }
<a name="l00073"></a><a class="code" href="structMatrixSlice.html#d92c2e882b4aed3f8faf17d2fb8350f3">00073</a>     <span class="keywordtype">bool</span> <a class="code" href="structMatrixSlice.html#d92c2e882b4aed3f8faf17d2fb8350f3" title="Returns whether the matrix is allocated (and thus usable for indexing).">isValid</a>()<span class="keyword"> const </span>{
<a name="l00074"></a>00074         <span class="keywordflow">return</span> <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>;
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076 
<a name="l00078"></a><a class="code" href="structMatrixSlice.html#a49159eb64e8003f99af3fefd721fc8c">00078</a>     <span class="keywordtype">void</span> <a class="code" href="structMatrixSlice.html#a49159eb64e8003f99af3fefd721fc8c" title="Fills a submatrix of a valid matrix with a value.">fillSubMatrix</a>(<span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block,T value) {
<a name="l00079"></a>00079         ASSERT( <a class="code" href="structMatrixSlice.html#d92c2e882b4aed3f8faf17d2fb8350f3" title="Returns whether the matrix is allocated (and thus usable for indexing).">isValid</a>() );
<a name="l00080"></a>00080     <span class="comment">//  compute begin and end column starts</span>
<a name="l00081"></a>00081         T *begin= <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>+block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a>+<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>*block.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a>
<a name="l00082"></a>00082         , *end= <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>+block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a>+<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>*block.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>;
<a name="l00083"></a>00083     <span class="comment">//  fill the columns</span>
<a name="l00084"></a>00084         <span class="keywordflow">for</span> (T *it= begin; it!=end; it+= <a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>)
<a name="l00085"></a>00085             std::fill( it, it+block.<a class="code" href="structBlock.html#345f9061cb0c5572118ab0b9cb4ed8f4">height</a>(), value );
<a name="l00086"></a>00086     }
<a name="l00090"></a><a class="code" href="structMatrixSlice.html#3b0c7c24f9813ab4b84d401b057204a5">00090</a>     <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice</a>&amp; <a class="code" href="structMatrixSlice.html#3b0c7c24f9813ab4b84d401b057204a5" title="Shifts the indexing of this matrix - dangerous.">shiftMatrix</a>(I x0,I y0) {
<a name="l00091"></a>00091         ASSERT( <a class="code" href="structMatrixSlice.html#d92c2e882b4aed3f8faf17d2fb8350f3" title="Returns whether the matrix is allocated (and thus usable for indexing).">isValid</a>() );
<a name="l00092"></a>00092         <a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>+= x0*<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>+y0;
<a name="l00093"></a>00093         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00094"></a>00094     }
<a name="l00096"></a><a class="code" href="structMatrixSlice.html#6e103328ac29844b05067253195b4361">00096</a>     <span class="keywordtype">void</span> <a class="code" href="structMatrixSlice.html#6e103328ac29844b05067253195b4361" title="Computes relative position of a pointer in the matrix (always 0 &amp;lt;= y &amp;lt; colSkip)...">getPosition</a>(<span class="keyword">const</span> T *elem,<span class="keywordtype">int</span> &amp;x,<span class="keywordtype">int</span> &amp;y)<span class="keyword"> const </span>{
<a name="l00097"></a>00097         ASSERT( <a class="code" href="structMatrixSlice.html#d92c2e882b4aed3f8faf17d2fb8350f3" title="Returns whether the matrix is allocated (and thus usable for indexing).">isValid</a>() );
<a name="l00098"></a>00098         PtrInt diff= elem-<a class="code" href="structMatrixSlice.html#d3e17ef030c0eff8359e7a5724b6ddfe" title="pointer to the top-left pixel">start</a>;
<a name="l00099"></a>00099         <span class="keywordflow">if</span> (diff&gt;=0) {
<a name="l00100"></a>00100             x= diff/<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>;
<a name="l00101"></a>00101             y= diff%<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>;
<a name="l00102"></a>00102         } <span class="keywordflow">else</span> {
<a name="l00103"></a>00103             x= -((-diff-1)/<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a>) -1;
<a name="l00104"></a>00104             y= <a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a> - (-diff-1)%<a class="code" href="structMatrixSlice.html#3c4024931b81d0fd34db267f782fcf7a" title="how many pixels to skip to get in the next column">colSkip</a> -1;
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106     }
<a name="l00107"></a>00107 }; <span class="comment">// MatrixSlice class template</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 
<a name="l00113"></a><a class="code" href="structMatrixSummer.html">00113</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I=PtrInt&gt; <span class="keyword">struct </span><a class="code" href="structMatrixSummer.html" title="MatrixSummer objects store partial sums of a matrix, allowing quick computation of...">MatrixSummer</a> {
<a name="l00114"></a>00114     <span class="keyword">typedef</span> T Result;
<a name="l00115"></a>00115 
<a name="l00116"></a><a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52">00116</a>     <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice&lt;T,I&gt;</a> <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>; 
<a name="l00117"></a>00117 
<a name="l00119"></a><a class="code" href="structMatrixSummer.html#762909e1bcda2febc44fd20bace92765">00119</a>     <span class="keywordtype">bool</span> <a class="code" href="structMatrixSummer.html#762909e1bcda2febc44fd20bace92765" title="Returns whether the object is filled with data.">isValid</a>()<span class="keyword">  const   </span>{ <span class="keywordflow">return</span> <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>.isValid(); }
<a name="l00121"></a><a class="code" href="structMatrixSummer.html#e697e761438fc6b27f23e71d94a2601e">00121</a>     <span class="keywordtype">void</span> <a class="code" href="structMatrixSummer.html#e697e761438fc6b27f23e71d94a2601e" title="Clears the object.">free</a>()             { <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>.free(); };
<a name="l00122"></a>00122 
<a name="l00124"></a><a class="code" href="structMatrixSummer.html#af9908c3ed5b7e55698092a4f736cb42">00124</a>     Result <a class="code" href="structMatrixSummer.html#af9908c3ed5b7e55698092a4f736cb42" title="Computes the sum of a rectangle (in constant time).">getSum</a>(I x0,I y0,I xend,I yend)<span class="keyword"> const </span>{
<a name="l00125"></a>00125         ASSERT( <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>.isValid() );
<a name="l00126"></a>00126         <span class="keywordflow">return</span> <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[xend][yend] -(<a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[x0][yend]+<a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[xend][y0]) +<a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[x0][y0];
<a name="l00127"></a>00127     }
<a name="l00129"></a><a class="code" href="structMatrixSummer.html#32f1110dacf02dde3390ea7e15fb5488">00129</a>     Result <a class="code" href="structMatrixSummer.html#af9908c3ed5b7e55698092a4f736cb42" title="Computes the sum of a rectangle (in constant time).">getSum</a>(<span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;b)<span class="keyword"> const </span>
<a name="l00130"></a>00130 <span class="keyword">        </span>{ <span class="keywordflow">return</span> <a class="code" href="structMatrixSummer.html#32f1110dacf02dde3390ea7e15fb5488" title="A shortcut to get the sum of a block.">getSum</a>( b.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a>, b.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a>, b.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>, b.<a class="code" href="structBlock.html#02d734c9e46dccdd7f5652d19eef9e8e">yend</a> ); }
<a name="l00131"></a>00131 
<a name="l00134"></a><a class="code" href="structMatrixSummer.html#88f0b334b83943f12acbc776a281595f">00134</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> Input&gt; <span class="keywordtype">void</span> <a class="code" href="structMatrixSummer.html#88f0b334b83943f12acbc776a281595f" title="Prepares object to make sums for a matrix.">fill</a>(Input inp,I width,I height) {
<a name="l00135"></a>00135         <span class="keywordflow">if</span> ( !<a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>.isValid() )
<a name="l00136"></a>00136             <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>.allocate(width+1,height+1);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <span class="comment">//  fill the edges with zeroes</span>
<a name="l00139"></a>00139         <span class="keywordflow">for</span> (I i=0; i&lt;=width; ++i)
<a name="l00140"></a>00140             <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[i][0]= 0;
<a name="l00141"></a>00141         <span class="keywordflow">for</span> (I j=1; j&lt;=height; ++j)
<a name="l00142"></a>00142             <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[0][j]= 0;
<a name="l00143"></a>00143     <span class="comment">//  acummulate in the y-growing direction</span>
<a name="l00144"></a>00144         <span class="keywordflow">for</span> (I i=1; i&lt;=width; ++i)
<a name="l00145"></a>00145             <span class="keywordflow">for</span> (I j=1; j&lt;=height; ++j)
<a name="l00146"></a>00146                 <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[i][j]= <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[i][j-1] + Result(inp[i-1][j-1]);
<a name="l00147"></a>00147     <span class="comment">//  acummulate in the x-growing direction</span>
<a name="l00148"></a>00148         <span class="keywordflow">for</span> (I i=2; i&lt;=width; ++i)
<a name="l00149"></a>00149             <span class="keywordflow">for</span> (I j=1; j&lt;=height; ++j)
<a name="l00150"></a>00150                 <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[i][j]+= <a class="code" href="structMatrixSummer.html#012495b2fa56c436bfe7160cc0667f52" title="Internal matrix containing precomputed partial sums.">sums</a>[i-1][j];
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 }; <span class="comment">// MatrixSummer class template</span>
<a name="l00153"></a>00153 
<a name="l00155"></a><a class="code" href="structDoubleNum.html">00155</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> Num&gt; <span class="keyword">struct </span><a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> {
<a name="l00156"></a>00156     Num value, square;
<a name="l00157"></a>00157     
<a name="l00158"></a>00158     <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a>() 
<a name="l00159"></a>00159         { DEBUG_ONLY( value= square= std::numeric_limits&lt;Num&gt;::quiet_NaN(); ) }
<a name="l00160"></a>00160     
<a name="l00161"></a>00161     <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a>(Num val)
<a name="l00162"></a>00162     : value(val), square(<a class="code" href="util_8h.html#c768d5f9cea71e68e404f4b2455462a6" title="Helper template function computing the square of a number.">sqr</a>(val)) {}
<a name="l00163"></a>00163     
<a name="l00164"></a>00164     <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a>(<span class="keyword">const</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> &amp;other)
<a name="l00165"></a>00165     : value(other.<a class="code" href="structDoubleNum.html#51c659f29227f255972df92f0f1c75ae">value</a>), square(other.<a class="code" href="structDoubleNum.html#6572882bc2743fa8246787f5513b7a33">square</a>) {}
<a name="l00166"></a>00166     
<a name="l00167"></a>00167     <span class="keywordtype">void</span> unpack(Num &amp;val,Num &amp;sq)<span class="keyword"> const </span>{ val= value; sq= square; }
<a name="l00168"></a>00168     
<a name="l00169"></a>00169     <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a>&amp; operator+=(<span class="keyword">const</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> &amp;other) {
<a name="l00170"></a>00170         value+= other.<a class="code" href="structDoubleNum.html#51c659f29227f255972df92f0f1c75ae">value</a>;
<a name="l00171"></a>00171         square+= other.<a class="code" href="structDoubleNum.html#6572882bc2743fa8246787f5513b7a33">square</a>;
<a name="l00172"></a>00172         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174     <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a>&amp; operator-=(<span class="keyword">const</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> &amp;other) {
<a name="l00175"></a>00175         value-= other.<a class="code" href="structDoubleNum.html#51c659f29227f255972df92f0f1c75ae">value</a>;
<a name="l00176"></a>00176         square-= other.<a class="code" href="structDoubleNum.html#6572882bc2743fa8246787f5513b7a33">square</a>;
<a name="l00177"></a>00177         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     <span class="keyword">friend</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> operator+(<span class="keyword">const</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> &amp;a,<span class="keyword">const</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> &amp;b) 
<a name="l00180"></a>00180         { <span class="keywordflow">return</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a>(a)+= b; }
<a name="l00181"></a>00181     <span class="keyword">friend</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> operator-(<span class="keyword">const</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> &amp;a,<span class="keyword">const</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a> &amp;b) 
<a name="l00182"></a>00182         { <span class="keywordflow">return</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum</a>(a)-= b; }
<a name="l00183"></a>00183 }; <span class="comment">// DoubleNum template struct</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00187"></a>00187 <span class="keyword">template</span>&lt; <span class="keyword">class</span> SumT, <span class="keyword">class</span> PixT, <span class="keyword">class</span> I=PtrInt &gt;
<a name="l00188"></a><a class="code" href="structSummedMatrix.html">00188</a> <span class="keyword">struct </span><a class="code" href="structSummedMatrix.html" title="Structure for a block of pixels - also contains summers and dimensions.">SummedMatrix</a> {
<a name="l00189"></a>00189     <span class="keyword">typedef</span> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">DoubleNum&lt;SumT&gt;</a> <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">BSumRes</a>;
<a name="l00190"></a>00190     <span class="keyword">typedef</span> <a class="code" href="structMatrixSummer.html">MatrixSummer&lt;BSumRes,I&gt;</a> <a class="code" href="structMatrixSummer.html">BSummer</a>;
<a name="l00191"></a>00191     
<a name="l00192"></a>00192     I width                     
<a name="l00193"></a><a class="code" href="structSummedMatrix.html#d4f4c91c0ac09cb6e90ac5501e953197">00193</a>     , height;                   
<a name="l00194"></a><a class="code" href="structSummedMatrix.html#47d83460ba1ce3bfea214a22e39e53e1">00194</a>     <a class="code" href="structMatrixSlice.html">MatrixSlice&lt;PixT&gt;</a> pixels;   
<a name="l00195"></a><a class="code" href="structSummedMatrix.html#0ecb903a1f7f211faf564c4845debe30">00195</a>     <a class="code" href="structMatrixSummer.html">BSummer</a> summer;             
<a name="l00196"></a><a class="code" href="structSummedMatrix.html#1b391809efb030eb19c3c13d963801ef">00196</a>     <span class="keywordtype">bool</span> sumsValid;             
<a name="l00197"></a>00197     
<a name="l00199"></a><a class="code" href="structSummedMatrix.html#a78618dcd394e52f28862de0526fd6ba">00199</a>     <span class="keywordtype">void</span> <a class="code" href="structSummedMatrix.html#a78618dcd394e52f28862de0526fd6ba" title="Sets the size of pixels, optionally allocates memory.">setSize</a>( I width_, I height_ ) {
<a name="l00200"></a>00200         free();
<a name="l00201"></a>00201         width= width_;
<a name="l00202"></a>00202         height= height_;
<a name="l00203"></a>00203         pixels.allocate(width,height);
<a name="l00204"></a>00204     }
<a name="l00206"></a><a class="code" href="structSummedMatrix.html#34a9e93442c17467575c525f64ee3fad">00206</a>     <span class="keywordtype">void</span> <a class="code" href="structSummedMatrix.html#34a9e93442c17467575c525f64ee3fad" title="Frees the memory.">free</a>(<span class="keywordtype">bool</span> freePixels=<span class="keyword">true</span>) {
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (freePixels)
<a name="l00208"></a>00208             pixels.free();
<a name="l00209"></a>00209         <span class="keywordflow">else</span>
<a name="l00210"></a>00210             pixels.start= 0;
<a name="l00211"></a>00211         summer.free();
<a name="l00212"></a>00212         sumsValid= <span class="keyword">false</span>;
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214     
<a name="l00216"></a><a class="code" href="structSummedMatrix.html#e9476d31c5c639f3bb08104205949ad8">00216</a>     <span class="keywordtype">void</span> <a class="code" href="structSummedMatrix.html#e9476d31c5c639f3bb08104205949ad8" title="Just validates both summers (if needed).">summers_makeValid</a>()<span class="keyword"> const </span>{
<a name="l00217"></a>00217         ASSERT(pixels.isValid());
<a name="l00218"></a>00218         <span class="keywordflow">if</span> (!sumsValid) {
<a name="l00219"></a>00219             <a class="code" href="util_8h.html#7dcbfa1a47034c99f2e76ea4ffa8700a" title="Automatic version of const_cast for pointers.">constCast</a>(summer).fill(pixels,width,height);
<a name="l00220"></a>00220             <a class="code" href="util_8h.html#7dcbfa1a47034c99f2e76ea4ffa8700a" title="Automatic version of const_cast for pointers.">constCast</a>(sumsValid)= <span class="keyword">true</span>;
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222     }
<a name="l00224"></a><a class="code" href="structSummedMatrix.html#b521c6a2ede2b84798d137e24e1b3b0a">00224</a>     <span class="keywordtype">void</span> summers_invalidate() 
<a name="l00225"></a>00225         { sumsValid= <span class="keyword">false</span>; }
<a name="l00227"></a><a class="code" href="structSummedMatrix.html#c2521574b25074a034f38e1f0bf41c8d">00227</a>     <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">BSumRes</a> getSums(<span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block)<span class="keyword"> const </span>
<a name="l00228"></a>00228 <span class="keyword">        </span>{ <span class="keywordflow">return</span> <a class="code" href="structSummedMatrix.html#c2521574b25074a034f38e1f0bf41c8d" title="A shortcut for getting sums of a block.">getSums</a>( block.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a>, block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a>, block.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>, block.<a class="code" href="structBlock.html#02d734c9e46dccdd7f5652d19eef9e8e">yend</a> ); }   
<a name="l00230"></a><a class="code" href="structSummedMatrix.html#ebad6b5d391513908f90e91cfcac7574">00230</a>     <a class="code" href="structDoubleNum.html" title="Helper structure for computing with value and squared sums at once.">BSumRes</a> <a class="code" href="structSummedMatrix.html#ebad6b5d391513908f90e91cfcac7574" title="Gets both sums of a nonempty rectangle in pixels, the summer isn&amp;#39;t validated...">getSums</a>( I x0, I y0, I xend, I yend )<span class="keyword"> const </span>{
<a name="l00231"></a>00231         ASSERT( sumsValid &amp;&amp; x0&gt;=0 &amp;&amp; y0&gt;=0 &amp;&amp; xend&gt;x0 &amp;&amp; yend&gt;y0 
<a name="l00232"></a>00232             &amp;&amp; xend&lt;=width &amp;&amp; yend&lt;=height );
<a name="l00233"></a>00233         <span class="keywordflow">return</span> summer.getSum(x0,y0,xend,yend);
<a name="l00234"></a>00234     }
<a name="l00236"></a><a class="code" href="structSummedMatrix.html#6ff5f47fa61c392181e6f1fc05106bad">00236</a>     SumT <a class="code" href="structSummedMatrix.html#6ff5f47fa61c392181e6f1fc05106bad" title="Gets only the sum of values (not the sum of squares).">getValueSum</a>( I x0, I y0, I xend, I yend )<span class="keyword"> const </span>{
<a name="l00237"></a>00237         <span class="comment">// \todo quicker version</span>
<a name="l00238"></a>00238         <span class="keywordflow">return</span> getSums(x0,y0,xend,yend).value;
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 }; <span class="comment">// SummedPixels template struct</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00246"></a><a class="code" href="namespaceMatrixWalkers.html">00246</a> <span class="keyword">namespace </span>MatrixWalkers {
<a name="l00247"></a>00247 
<a name="l00251"></a>00251     <span class="keyword">template</span> &lt; <span class="keyword">class</span> Checked, <span class="keyword">class</span> Unchecked, <span class="keyword">class</span> Operator &gt;
<a name="l00252"></a><a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918">00252</a>     Operator <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( <a class="code" href="structMatrixWalkers_1_1Checked.html" title="Checked_ iterator for a rectangle in a matrix, no rotation.">Checked</a> checked, Unchecked unchecked, Operator oper ) {
<a name="l00253"></a>00253     <span class="comment">//  outer cycle start - to be always run at least once</span>
<a name="l00254"></a>00254         ASSERT( checked.<a class="code" href="structMatrixWalkers_1_1Checked.html#f9b0ae5eaac8ea29d9d8804575b9ace9">outerCond</a>() );
<a name="l00255"></a>00255         <span class="keywordflow">do</span> {
<a name="l00256"></a>00256         <span class="comment">//  inner initialization</span>
<a name="l00257"></a>00257             checked.<a class="code" href="structMatrixWalkers_1_1RotBase.html#061c7fbcaab18de98557e98be33269ec">innerInit</a>();
<a name="l00258"></a>00258             unchecked.innerInit();
<a name="l00259"></a>00259         <span class="comment">// inner cycle start - to be always run at least once</span>
<a name="l00260"></a>00260             ASSERT( checked.<a class="code" href="structMatrixWalkers_1_1Checked.html#540997bf3efc6fc32129bc254a429a2e">innerCond</a>() );
<a name="l00261"></a>00261             <span class="keywordflow">do</span> {
<a name="l00262"></a>00262             <span class="comment">//  perform the operation and do the inner step for both iterators</span>
<a name="l00263"></a>00263                 oper( checked.<a class="code" href="structMatrixWalkers_1_1RotBase.html#ed92486081b5d177a58c41ddd25bbe75">get</a>(), unchecked.get() );
<a name="l00264"></a>00264                 checked.<a class="code" href="structMatrixWalkers_1_1Rotation__0.html#9bafe4e28570f549778d1a090ba6dd58">innerStep</a>();
<a name="l00265"></a>00265                 unchecked.innerStep();
<a name="l00266"></a>00266             } <span class="keywordflow">while</span> ( checked.<a class="code" href="structMatrixWalkers_1_1Checked.html#540997bf3efc6fc32129bc254a429a2e">innerCond</a>() );
<a name="l00267"></a>00267 
<a name="l00268"></a>00268         <span class="comment">//  signal the end of inner cycle to the operator and do the outer step for both iterators</span>
<a name="l00269"></a>00269             oper.innerEnd();
<a name="l00270"></a>00270             checked.<a class="code" href="structMatrixWalkers_1_1Checked.html#ceda7af9624b8f5dccbb5c33a5eea3b1">outerStep</a>();
<a name="l00271"></a>00271             unchecked.outerStep();
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         } <span class="keywordflow">while</span> ( checked.<a class="code" href="structMatrixWalkers_1_1Checked.html#f9b0ae5eaac8ea29d9d8804575b9ace9">outerCond</a>() );
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="keywordflow">return</span> oper;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00280"></a><a class="code" href="structMatrixWalkers_1_1RotBase.html">00280</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a> {
<a name="l00281"></a>00281     <span class="keyword">public</span>:
<a name="l00282"></a>00282         <span class="keyword">typedef</span> <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice&lt;T,I&gt;</a> <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">TMatrix</a>;
<a name="l00283"></a>00283     <span class="keyword">protected</span>:
<a name="l00284"></a><a class="code" href="structMatrixWalkers_1_1RotBase.html#1216df3565eacc65174cf2760c0701c8">00284</a>         <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">TMatrix</a> current;    
<a name="l00285"></a><a class="code" href="structMatrixWalkers_1_1RotBase.html#84f69ddd2f9c8a668321f974b1bb2010">00285</a>         T *lastStart;       
<a name="l00286"></a>00286 
<a name="l00287"></a>00287     <span class="keyword">public</span>:
<a name="l00288"></a>00288         <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>( <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">TMatrix</a> matrix, <span class="keywordtype">int</span> x0, <span class="keywordtype">int</span> y0 )
<a name="l00289"></a>00289         : current( matrix.shiftMatrix(x0,y0) ), lastStart(current.start) { 
<a name="l00290"></a>00290             DEBUG_ONLY( current.start= 0; )
<a name="l00291"></a>00291             ASSERT( matrix.<a class="code" href="structMatrixSlice.html#d92c2e882b4aed3f8faf17d2fb8350f3" title="Returns whether the matrix is allocated (and thus usable for indexing).">isValid</a>() );
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="keywordtype">void</span> innerInit()    { current.start= lastStart; }
<a name="l00295"></a>00295         T&amp; <span class="keyword">get</span>()            { <span class="keywordflow">return</span> *current.start; }
<a name="l00296"></a>00296     }; <span class="comment">// RotBase class template</span>
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <span class="preprocessor">    #define ROTBASE_INHERIT \</span>
<a name="l00299"></a>00299 <span class="preprocessor">        typedef typename RotBase&lt;T,I&gt;::TMatrix TMatrix; \</span>
<a name="l00300"></a>00300 <span class="preprocessor">        using RotBase&lt;T,I&gt;::current; \</span>
<a name="l00301"></a>00301 <span class="preprocessor">        using RotBase&lt;T,I&gt;::lastStart;</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span>
<a name="l00304"></a><a class="code" href="structMatrixWalkers_1_1Rotation__0.html">00304</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I=PtrInt&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__0.html" title="No rotation: x-&amp;gt;, y-&amp;gt;.">Rotation_0</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00305"></a>00305         <a class="code" href="structMatrixWalkers_1_1Rotation__0.html" title="No rotation: x-&amp;gt;, y-&amp;gt;.">Rotation_0</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00306"></a>00306         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a>, block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a> ) {}
<a name="l00307"></a>00307         
<a name="l00308"></a>00308         <span class="keyword">explicit</span> Rotation_0( TMatrix matrix, I x0=0, I y0=0 )
<a name="l00309"></a>00309         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, x0, y0 ) {}
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="keywordtype">void</span> outerStep() { lastStart+= current.colSkip; }
<a name="l00312"></a>00312         <span class="keywordtype">void</span> innerStep() { ++current.start; }
<a name="l00313"></a>00313     };
<a name="l00314"></a>00314 
<a name="l00316"></a><a class="code" href="structMatrixWalkers_1_1Rotation__1__T.html">00316</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__1__T.html" title="Rotated 90deg\.">Rotation_1_T</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00317"></a>00317         <a class="code" href="structMatrixWalkers_1_1Rotation__1__T.html" title="Rotated 90deg\.">Rotation_1_T</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00318"></a>00318         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>-1, block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a> ) {}
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="keywordtype">void</span> outerStep() { lastStart-= current.colSkip; }
<a name="l00321"></a>00321         <span class="keywordtype">void</span> innerStep() { ++current.start; }
<a name="l00322"></a>00322     };
<a name="l00323"></a>00323 
<a name="l00325"></a><a class="code" href="structMatrixWalkers_1_1Rotation__2.html">00325</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__2.html" title="Rotated 180deg\.">Rotation_2</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00326"></a>00326         <a class="code" href="structMatrixWalkers_1_1Rotation__2.html" title="Rotated 180deg\.">Rotation_2</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00327"></a>00327         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>-1, block.<a class="code" href="structBlock.html#02d734c9e46dccdd7f5652d19eef9e8e">yend</a>-1 ) {}
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         <span class="keywordtype">void</span> outerStep() { lastStart-= current.colSkip; }
<a name="l00330"></a>00330         <span class="keywordtype">void</span> innerStep() { --current.start; }
<a name="l00331"></a>00331     };
<a name="l00332"></a>00332 
<a name="l00334"></a><a class="code" href="structMatrixWalkers_1_1Rotation__3__T.html">00334</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__3__T.html" title="Rotated 270deg\.">Rotation_3_T</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00335"></a>00335         <a class="code" href="structMatrixWalkers_1_1Rotation__3__T.html" title="Rotated 270deg\.">Rotation_3_T</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00336"></a>00336         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a>, block.<a class="code" href="structBlock.html#02d734c9e46dccdd7f5652d19eef9e8e">yend</a>-1 ) {}
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         <span class="keywordtype">void</span> outerStep() { lastStart+= current.colSkip; }
<a name="l00339"></a>00339         <span class="keywordtype">void</span> innerStep() { --current.start; }
<a name="l00340"></a>00340     };
<a name="l00341"></a>00341 
<a name="l00343"></a><a class="code" href="structMatrixWalkers_1_1Rotation__0__T.html">00343</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__0__T.html" title="No rotation, transposed: y-&amp;gt;, x-&amp;gt;.">Rotation_0_T</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00344"></a>00344         <a class="code" href="structMatrixWalkers_1_1Rotation__0__T.html" title="No rotation, transposed: y-&amp;gt;, x-&amp;gt;.">Rotation_0_T</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00345"></a>00345         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a>, block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a> ) {}
<a name="l00346"></a>00346         
<a name="l00347"></a>00347         <span class="keyword">explicit</span> Rotation_0_T( TMatrix matrix, I x0=0, I y0=0 )
<a name="l00348"></a>00348         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, x0, y0 ) {}
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         <span class="keywordtype">void</span> outerStep() { ++lastStart; }
<a name="l00351"></a>00351         <span class="keywordtype">void</span> innerStep() { current.start+= current.colSkip; }
<a name="l00352"></a>00352     };
<a name="l00353"></a>00353 
<a name="l00355"></a><a class="code" href="structMatrixWalkers_1_1Rotation__1.html">00355</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__1.html" title="Rotated 90deg\.">Rotation_1</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00356"></a>00356         <a class="code" href="structMatrixWalkers_1_1Rotation__1.html" title="Rotated 90deg\.">Rotation_1</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00357"></a>00357         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>-1, block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a> ) {}
<a name="l00358"></a>00358 
<a name="l00359"></a>00359         <span class="keywordtype">void</span> outerStep() { ++lastStart; }
<a name="l00360"></a>00360         <span class="keywordtype">void</span> innerStep() { current.start-= current.colSkip; }
<a name="l00361"></a>00361     };
<a name="l00362"></a>00362 
<a name="l00364"></a><a class="code" href="structMatrixWalkers_1_1Rotation__2__T.html">00364</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__2__T.html" title="Rotated 180deg\.">Rotation_2_T</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00365"></a>00365         <a class="code" href="structMatrixWalkers_1_1Rotation__2__T.html" title="Rotated 180deg\.">Rotation_2_T</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00366"></a>00366         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>-1, block.<a class="code" href="structBlock.html#02d734c9e46dccdd7f5652d19eef9e8e">yend</a>-1 ) {}
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         <span class="keywordtype">void</span> outerStep() { --lastStart; }
<a name="l00369"></a>00369         <span class="keywordtype">void</span> innerStep() { current.start-= current.colSkip; }
<a name="l00370"></a>00370     };
<a name="l00371"></a>00371 
<a name="l00373"></a><a class="code" href="structMatrixWalkers_1_1Rotation__3.html">00373</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation__3.html" title="Rotated 270deg\.">Rotation_3</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1RotBase.html" title="Base structure for walkers.">RotBase</a>&lt;T,I&gt; { ROTBASE_INHERIT
<a name="l00374"></a>00374         <a class="code" href="structMatrixWalkers_1_1Rotation__3.html" title="Rotated 270deg\.">Rotation_3</a>( TMatrix matrix, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00375"></a>00375         : <a class="code" href="structMatrixWalkers_1_1RotBase.html">RotBase&lt;T,I&gt;</a>( matrix, block.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a>, block.<a class="code" href="structBlock.html#02d734c9e46dccdd7f5652d19eef9e8e">yend</a>-1 ) {}
<a name="l00376"></a>00376 
<a name="l00377"></a>00377         <span class="keywordtype">void</span> outerStep() { --lastStart; }
<a name="l00378"></a>00378         <span class="keywordtype">void</span> innerStep() { current.start+= current.colSkip; }
<a name="l00379"></a>00379     };
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     
<a name="l00384"></a>00384     <span class="keyword">template</span>&lt;<span class="keyword">class</span> Check,<span class="keyword">class</span> U,<span class="keyword">class</span> Operator&gt; 
<a name="l00385"></a><a class="code" href="namespaceMatrixWalkers.html#f40146ad3b6dcb1bb5919d1efc936d93">00385</a>     <span class="keyword">inline</span> Operator <a class="code" href="namespaceMatrixWalkers.html#f40146ad3b6dcb1bb5919d1efc936d93" title="A flavour of walkOperate() choosing the right Rotation_* iterator based on rotation...">walkOperateCheckRotate</a>( Check checked, Operator oper
<a name="l00386"></a>00386     , <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice&lt;U&gt;</a> pixels2, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block2, <span class="keywordtype">char</span> rotation) {
<a name="l00387"></a>00387         <span class="keyword">typedef</span> PtrInt I;
<a name="l00388"></a>00388         <span class="keywordflow">switch</span> (rotation) {
<a name="l00389"></a>00389             <span class="keywordflow">case</span> 0: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__0.html" title="No rotation: x-&amp;gt;, y-&amp;gt;.">Rotation_0  &lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00390"></a>00390             <span class="keywordflow">case</span> 1: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__0__T.html" title="No rotation, transposed: y-&amp;gt;, x-&amp;gt;.">Rotation_0_T&lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00391"></a>00391             <span class="keywordflow">case</span> 2: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__1.html" title="Rotated 90deg\.">Rotation_1  &lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00392"></a>00392             <span class="keywordflow">case</span> 3: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__1__T.html" title="Rotated 90deg\.">Rotation_1_T&lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00393"></a>00393             <span class="keywordflow">case</span> 4: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__2.html" title="Rotated 180deg\.">Rotation_2  &lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00394"></a>00394             <span class="keywordflow">case</span> 5: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__2__T.html" title="Rotated 180deg\.">Rotation_2_T&lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00395"></a>00395             <span class="keywordflow">case</span> 6: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__3.html" title="Rotated 270deg\.">Rotation_3  &lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00396"></a>00396             <span class="keywordflow">case</span> 7: <span class="keywordflow">return</span> <a class="code" href="namespaceMatrixWalkers.html#3292f064e443c2a947d2cc73c9805918" title="Iterates two matrix iterators and performs an action.">walkOperate</a>( checked, <a class="code" href="structMatrixWalkers_1_1Rotation__3__T.html" title="Rotated 270deg\.">Rotation_3_T&lt;U,I&gt;</a>(pixels2,block2) , oper );
<a name="l00397"></a>00397             <span class="keywordflow">default</span>: ASSERT(<span class="keyword">false</span>); <span class="keywordflow">return</span> oper;
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400     
<a name="l00401"></a>00401     
<a name="l00403"></a><a class="code" href="structMatrixWalkers_1_1Rotation.html">00403</a>     <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Rotation.html" title="Performs manipulations with rotation codes 0-7 (dihedral group of order eight).">Rotation</a> {
<a name="l00405"></a><a class="code" href="structMatrixWalkers_1_1Rotation.html#a57f301d037fb697cbce5276da7cb568">00405</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="structMatrixWalkers_1_1Rotation.html#a57f301d037fb697cbce5276da7cb568" title="Asserts the parameter is within 0-7.">check</a>(<span class="keywordtype">int</span> DEBUG_ONLY(r)) {
<a name="l00406"></a>00406             ASSERT( 0&lt;=r &amp;&amp; r&lt;8 );
<a name="l00407"></a>00407         }
<a name="l00409"></a><a class="code" href="structMatrixWalkers_1_1Rotation.html#e4d8b89a6af9914568b46289fb538909">00409</a>         <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="structMatrixWalkers_1_1Rotation.html#e4d8b89a6af9914568b46289fb538909" title="Returns inverted rotation (the one that takes this one back to identity).">invert</a>(<span class="keywordtype">int</span> r) {
<a name="l00410"></a>00410             check(r);
<a name="l00411"></a>00411             <span class="keywordflow">return</span> (4-r/2)%4 *2 +r%2;
<a name="l00412"></a>00412         }
<a name="l00414"></a><a class="code" href="structMatrixWalkers_1_1Rotation.html#6b2fd537afa1abce2c4b37dc7e40a3dc">00414</a>         <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="structMatrixWalkers_1_1Rotation.html#6b2fd537afa1abce2c4b37dc7e40a3dc" title="Computes rotation equal to projecting at first with r1 and the result with r2.">compose</a>(<span class="keywordtype">int</span> r1,<span class="keywordtype">int</span> r2) {
<a name="l00415"></a>00415             check(r1); check(r2);
<a name="l00416"></a>00416             <span class="keywordflow">if</span> (r2%2)
<a name="l00417"></a>00417                 r1= invert(r1);
<a name="l00418"></a>00418             <span class="keywordflow">return</span> (r1/2 + r2/2) %4 *2+ ( (r1%2)^(r2%2) );
<a name="l00419"></a>00419         }
<a name="l00420"></a>00420     }; <span class="comment">// Rotation struct</span>
<a name="l00421"></a>00421     
<a name="l00423"></a><a class="code" href="structMatrixWalkers_1_1Checked.html">00423</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> I=PtrInt&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1Checked.html" title="Checked_ iterator for a rectangle in a matrix, no rotation.">Checked</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1Rotation__0.html" title="No rotation: x-&amp;gt;, y-&amp;gt;.">Rotation_0</a>&lt;T,I&gt; {
<a name="l00424"></a>00424         <span class="keyword">typedef</span> <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">MatrixSlice&lt;T,I&gt;</a> <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">TMatrix</a>;
<a name="l00425"></a>00425         <span class="keyword">typedef</span> <a class="code" href="structMatrixWalkers_1_1Rotation__0.html">Rotation_0&lt;T,I&gt;</a> <a class="code" href="structMatrixWalkers_1_1Rotation__0.html">Base</a>;
<a name="l00426"></a>00426         <span class="keyword">using</span> Base::current;
<a name="l00427"></a>00427         <span class="keyword">using</span> Base::lastStart;
<a name="l00428"></a>00428         
<a name="l00429"></a>00429         T *colEnd           
<a name="l00430"></a><a class="code" href="structMatrixWalkers_1_1Checked.html#22f992b9db9b389be60bfd71beffadd0">00430</a>         , *colsEndStart;    
<a name="l00431"></a>00431 
<a name="l00433"></a><a class="code" href="structMatrixWalkers_1_1Checked.html#0dc382f32c61657b9a0da09488212459">00433</a>         <a class="code" href="structMatrixWalkers_1_1Checked.html" title="Checked_ iterator for a rectangle in a matrix, no rotation.">Checked</a>( <a class="code" href="structMatrixSlice.html" title="A simple generic template for matrices of fixed size, uses shallow copying and manual...">TMatrix</a> pixels, <span class="keyword">const</span> <a class="code" href="structBlock.html" title="A simple structure representing a rectangle.">Block</a> &amp;block )
<a name="l00434"></a>00434         : <a class="code" href="structMatrixWalkers_1_1Rotation__0.html">Base</a>( pixels, block ), colEnd( pixels.start+pixels.colSkip*block.x0+block.yend )
<a name="l00435"></a>00435         , colsEndStart( pixels.start+pixels.colSkip*block.xend+block.y0 ) {
<a name="l00436"></a>00436             ASSERT( block.<a class="code" href="structBlock.html#94ad9c4eb82539b860af26894751148b">xend</a>&gt;block.<a class="code" href="structBlock.html#fadf3e74377e48a4121802807a98281f">x0</a> &amp;&amp; block.<a class="code" href="structBlock.html#02d734c9e46dccdd7f5652d19eef9e8e">yend</a>&gt;block.<a class="code" href="structBlock.html#46861437cbb0debca2cc82b7beef2ff3">y0</a> );
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         <span class="keywordtype">bool</span> outerCond() {
<a name="l00440"></a>00440             ASSERT(lastStart&lt;=colsEndStart); 
<a name="l00441"></a>00441             <span class="keywordflow">return</span> lastStart!=colsEndStart; 
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443         <span class="keywordtype">void</span> outerStep() {
<a name="l00444"></a>00444             colEnd+= current.colSkip; 
<a name="l00445"></a>00445             Base::outerStep();
<a name="l00446"></a>00446         }
<a name="l00447"></a>00447         <span class="keywordtype">bool</span> innerCond() {
<a name="l00448"></a>00448             ASSERT(current.start&lt;=colEnd);
<a name="l00449"></a>00449             <span class="keywordflow">return</span> current.start!=colEnd; 
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451     }; <span class="comment">// Checked class template</span>
<a name="l00452"></a>00452 
<a name="l00454"></a><a class="code" href="structMatrixWalkers_1_1CheckedImage.html">00454</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T,<span class="keyword">class</span> U&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1CheckedImage.html" title="Checked_ iterator for a whole QImage; no rotation, but always transposed.">CheckedImage</a> {
<a name="l00455"></a>00455         <span class="keyword">typedef</span> T QImage;
<a name="l00456"></a>00456         <span class="keyword">typedef</span> U QRgb;
<a name="l00457"></a>00457     <span class="keyword">protected</span>:
<a name="l00458"></a><a class="code" href="structMatrixWalkers_1_1CheckedImage.html#a769a06fff3f98f924dd5ca9684134ea">00458</a>         QImage &amp;img;    
<a name="l00459"></a>00459         <span class="keywordtype">int</span> lineIndex   
<a name="l00460"></a><a class="code" href="structMatrixWalkers_1_1CheckedImage.html#0f128b52f66f70651391ea432560c527">00460</a>         , width         
<a name="l00461"></a>00461         , height;       
<a name="l00462"></a>00462         QRgb *line      
<a name="l00463"></a><a class="code" href="structMatrixWalkers_1_1CheckedImage.html#c3a065824e00eb6d75d8087f2a3aa489">00463</a>         , *lineEnd;     
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     <span class="keyword">public</span>:
<a name="l00467"></a><a class="code" href="structMatrixWalkers_1_1CheckedImage.html#6af62d59b5a115c86d0a5882082f5503">00467</a>         <a class="code" href="structMatrixWalkers_1_1CheckedImage.html" title="Checked_ iterator for a whole QImage; no rotation, but always transposed.">CheckedImage</a>(QImage &amp;image)
<a name="l00468"></a>00468         : img(image), lineIndex(0), width(image.width()), height(image.height())
<a name="l00469"></a>00469             { DEBUG_ONLY(line=lineEnd=0;) }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471         <span class="keywordtype">bool</span> outerCond()    { <span class="keywordflow">return</span> lineIndex&lt;height; }
<a name="l00472"></a>00472         <span class="keywordtype">void</span> outerStep()    { ++lineIndex; }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474         <span class="keywordtype">void</span> innerInit()    { line= (QRgb*)img.scanLine(lineIndex); lineEnd= line+width; }
<a name="l00475"></a>00475         <span class="keywordtype">bool</span> innerCond()    { <span class="keywordflow">return</span> line!=lineEnd; }
<a name="l00476"></a>00476         <span class="keywordtype">void</span> innerStep()    { ++line; }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         QRgb&amp; <span class="keyword">get</span>()         { <span class="keywordflow">return</span> *line; }
<a name="l00479"></a>00479     }; <span class="comment">// CheckedImage class template</span>
<a name="l00480"></a>00480     
<a name="l00481"></a>00481 
<a name="l00483"></a><a class="code" href="structMatrixWalkers_1_1OperatorBase.html">00483</a>     <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1OperatorBase.html" title="A convenience base type for operators to use with walkOperate().">OperatorBase</a> {
<a name="l00484"></a>00484         <span class="keywordtype">void</span> innerEnd() {}
<a name="l00485"></a>00485     };
<a name="l00486"></a>00486 
<a name="l00488"></a><a class="code" href="structMatrixWalkers_1_1RDSummer.html">00488</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> TOut,<span class="keyword">class</span> TIn&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1RDSummer.html" title="An operator computing the sum of products.">RDSummer</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1OperatorBase.html" title="A convenience base type for operators to use with walkOperate().">OperatorBase</a> {
<a name="l00489"></a>00489         TOut totalSum, lineSum;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491         <a class="code" href="structMatrixWalkers_1_1RDSummer.html" title="An operator computing the sum of products.">RDSummer</a>()
<a name="l00492"></a>00492         : totalSum(0), lineSum(0) {}
<a name="l00493"></a>00493         <span class="keywordtype">void</span> operator()(<span class="keyword">const</span> TIn &amp;num1,<span class="keyword">const</span> TIn&amp; num2)
<a name="l00494"></a>00494             { lineSum+= TOut(num1) * TOut(num2); }
<a name="l00495"></a>00495         <span class="keywordtype">void</span> innerEnd()
<a name="l00496"></a>00496             { totalSum+= lineSum; lineSum= 0; }
<a name="l00497"></a>00497         TOut result()   
<a name="l00498"></a>00498             { ASSERT(!lineSum); <span class="keywordflow">return</span> totalSum; }
<a name="l00499"></a>00499     };
<a name="l00500"></a>00500 
<a name="l00502"></a><a class="code" href="structMatrixWalkers_1_1AddMulCopy.html">00502</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1AddMulCopy.html" title="An operator performing a= (b+toAdd)*toMul.">AddMulCopy</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1OperatorBase.html" title="A convenience base type for operators to use with walkOperate().">OperatorBase</a> {
<a name="l00503"></a>00503         <span class="keyword">const</span> T toAdd, toMul;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <a class="code" href="structMatrixWalkers_1_1AddMulCopy.html" title="An operator performing a= (b+toAdd)*toMul.">AddMulCopy</a>(T <span class="keyword">add</span>,T mul)
<a name="l00506"></a>00506         : toAdd(<span class="keyword">add</span>), toMul(mul) {}
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="keyword">template</span>&lt;<span class="keyword">class</span> R1,<span class="keyword">class</span> R2&gt; <span class="keywordtype">void</span> operator()(R1 &amp;res,R2 f)<span class="keyword"> const</span>
<a name="l00509"></a>00509 <span class="keyword">            </span>{ res= (f+toAdd)*toMul; }
<a name="l00510"></a>00510     };
<a name="l00511"></a>00511 
<a name="l00514"></a><a class="code" href="structMatrixWalkers_1_1MulAddCopyChecked.html">00514</a>     <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span><a class="code" href="structMatrixWalkers_1_1MulAddCopyChecked.html" title="An operator performing a= b*toMul+toAdd and moving the result into [min,max] bounds...">MulAddCopyChecked</a>: <span class="keyword">public</span> <a class="code" href="structMatrixWalkers_1_1OperatorBase.html" title="A convenience base type for operators to use with walkOperate().">OperatorBase</a> {
<a name="l00515"></a>00515         <span class="keyword">const</span> T toMul, toAdd, min, max;
<a name="l00516"></a>00516 
<a name="l00517"></a>00517         <a class="code" href="structMatrixWalkers_1_1MulAddCopyChecked.html" title="An operator performing a= b*toMul+toAdd and moving the result into [min,max] bounds...">MulAddCopyChecked</a>(T mul,T <span class="keyword">add</span>,T minVal,T maxVal)
<a name="l00518"></a>00518         : toMul(mul), toAdd(<span class="keyword">add</span>), min(minVal), max(maxVal) {}
<a name="l00519"></a>00519         
<a name="l00520"></a>00520         <span class="keyword">template</span>&lt;<span class="keyword">class</span> R1,<span class="keyword">class</span> R2&gt; <span class="keywordtype">void</span> operator()(R1 &amp;res,R2 f)<span class="keyword"> const</span>
<a name="l00521"></a>00521 <span class="keyword">            </span>{ res= <a class="code" href="util_8h.html#6aa187ac66cef5b77432861ece6bb71a" title="General bounds-checking template routine - returns max(low,min(value,high)).">checkBoundsFunc</a>( min, f*toMul+toAdd, max ); }
<a name="l00522"></a>00522     };
<a name="l00523"></a>00523 } <span class="comment">// MatrixWalkers namespace</span>
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="preprocessor">#endif // MATRIXUTIL_HEADER_</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Aug 6 22:33:14 2009 for Fractal Image Compressor by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
